<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galaxy - è®¾å¤‡ç®¡ç†</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        [v-cloak] { display: none; }
        .gradient-bg { background: linear-gradient(135deg, #0f0f23 0%, #1a1a3e 50%, #0f0f23 100%); }
        .glass-card { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .live-dot { animation: live 2s infinite; }
        @keyframes live { 0%, 100% { box-shadow: 0 0 0 0 rgba(0, 212, 255, 0.4); } 50% { box-shadow: 0 0 0 8px rgba(0, 212, 255, 0); } }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    </style>
</head>
<body class="gradient-bg min-h-screen text-white">
    <div id="app" v-cloak>
        <!-- Header -->
        <header class="border-b border-white/10">
            <div class="container mx-auto px-6 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <a href="/" class="text-3xl">ğŸŒŒ</a>
                        <div>
                            <h1 class="text-2xl font-bold bg-gradient-to-r from-cyan-400 to-purple-500 bg-clip-text text-transparent">
                                è®¾å¤‡ç®¡ç†
                            </h1>
                            <p class="text-sm text-gray-400">ç®¡ç†è¿æ¥çš„è®¾å¤‡ <span class="live-dot inline-block w-2 h-2 bg-green-400 rounded-full ml-2"></span></p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <span class="text-sm text-gray-400">åœ¨çº¿: <span class="text-green-400">{{ onlineCount }}</span>/{{ devices.length }}</span>
                        <span class="text-sm text-gray-400">å»¶è¿Ÿ: <span :class="latencyClass">{{ latency }}ms</span></span>
                        <a href="/" class="text-gray-400 hover:text-white transition">è¿”å›</a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main -->
        <main class="container mx-auto px-6 py-8">
            <!-- Stats -->
            <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-8">
                <div class="glass-card rounded-xl p-4">
                    <div class="text-gray-400 text-xs mb-1">æ€»è®¾å¤‡</div>
                    <div class="text-2xl font-bold text-cyan-400">{{ devices.length }}</div>
                    <div class="text-xs text-gray-500 mt-1">æ›´æ–°: {{ lastUpdate }}</div>
                </div>
                <div class="glass-card rounded-xl p-4">
                    <div class="text-gray-400 text-xs mb-1">åœ¨çº¿è®¾å¤‡</div>
                    <div class="text-2xl font-bold text-green-400">{{ onlineCount }}</div>
                </div>
                <div class="glass-card rounded-xl p-4">
                    <div class="text-gray-400 text-xs mb-1">Android</div>
                    <div class="text-2xl font-bold text-purple-400">{{ androidCount }}</div>
                </div>
                <div class="glass-card rounded-xl p-4">
                    <div class="text-gray-400 text-xs mb-1">Windows</div>
                    <div class="text-2xl font-bold text-yellow-400">{{ windowsCount }}</div>
                </div>
                <div class="glass-card rounded-xl p-4">
                    <div class="text-gray-400 text-xs mb-1">å…¶ä»–</div>
                    <div class="text-2xl font-bold text-pink-400">{{ otherCount }}</div>
                </div>
            </div>

            <!-- Devices -->
            <div class="glass-card rounded-xl overflow-hidden mb-8">
                <div class="border-b border-white/10 p-4">
                    <div class="flex items-center justify-between">
                        <h2 class="font-semibold">è®¾å¤‡åˆ—è¡¨</h2>
                        <button @click="addDevice" class="px-4 py-2 bg-cyan-600 rounded-lg text-sm hover:bg-cyan-700 transition">
                            + æ·»åŠ è®¾å¤‡
                        </button>
                    </div>
                </div>
                <div class="p-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div v-for="device in devices" :key="device.id" 
                             class="p-4 rounded-lg bg-white/5 hover:bg-white/10 transition"
                             :class="{'ring-2 ring-green-500': device.status === 'online'}">
                            <div class="flex items-center justify-between mb-3">
                                <div class="flex items-center space-x-3">
                                    <span class="text-3xl">{{ device.icon }}</span>
                                    <div>
                                        <div class="font-medium">{{ device.name }}</div>
                                        <div class="text-xs text-gray-400">{{ device.type }}</div>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span :class="['w-2 h-2 rounded-full', device.status === 'online' ? 'bg-green-400 pulse' : 'bg-gray-400']"></span>
                                    <span class="text-xs" :class="device.status === 'online' ? 'text-green-400' : 'text-gray-400'">
                                        {{ device.status === 'online' ? 'åœ¨çº¿' : 'ç¦»çº¿' }}
                                    </span>
                                </div>
                            </div>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-400">ID</span>
                                    <span class="font-mono text-xs">{{ device.id }}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">IP</span>
                                    <span>{{ device.ip || '-' }}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">å»¶è¿Ÿ</span>
                                    <span :class="getLatencyClass(device.latency)">{{ device.latency ? device.latency + 'ms' : '-' }}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">æœ€ååœ¨çº¿</span>
                                    <span>{{ device.lastSeen || '-' }}</span>
                                </div>
                            </div>
                            <div class="mt-3 flex space-x-2">
                                <button @click="connectDevice(device)" 
                                        :disabled="device.status === 'online'"
                                        :class="['flex-1 py-1.5 rounded text-xs', device.status === 'online' ? 'bg-gray-600' : 'bg-cyan-600 hover:bg-cyan-700']">
                                    {{ device.status === 'online' ? 'å·²è¿æ¥' : 'è¿æ¥' }}
                                </button>
                                <button @click="removeDevice(device)" class="px-3 py-1.5 bg-red-600/20 text-red-400 rounded text-xs hover:bg-red-600/30">
                                    ç§»é™¤
                                </button>
                            </div>
                        </div>
                    </div>
                    <div v-if="devices.length === 0" class="text-center py-12 text-gray-400">
                        <div class="text-4xl mb-4">ğŸ“±</div>
                        <div>æš‚æ— è®¾å¤‡</div>
                        <div class="text-sm mt-2">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æ·»åŠ è®¾å¤‡</div>
                    </div>
                </div>
            </div>

            <!-- Capabilities -->
            <div class="glass-card rounded-xl overflow-hidden">
                <div class="border-b border-white/10 p-4">
                    <h2 class="font-semibold">è®¾å¤‡èƒ½åŠ›</h2>
                </div>
                <div class="p-4">
                    <div class="flex flex-wrap gap-2">
                        <span v-for="cap in allCapabilities" :key="cap" 
                              class="px-3 py-1 rounded-full bg-white/5 text-sm">
                            {{ cap }}
                        </span>
                    </div>
                </div>
            </div>
        </main>

        <!-- Toast -->
        <div v-if="toast.show" :class="['fixed bottom-8 right-8 px-6 py-3 rounded-lg', toast.type === 'success' ? 'bg-green-600' : 'bg-red-600']">
            {{ toast.message }}
        </div>
    </div>

    <script>
        const { createApp } = Vue;
        
        createApp({
            data() {
                return {
                    latency: 0,
                    lastUpdate: '',
                    devices: [],
                    toast: { show: false, message: '', type: 'success' }
                };
            },
            computed: {
                latencyClass() {
                    if (this.latency < 100) return 'text-green-400';
                    if (this.latency < 500) return 'text-yellow-400';
                    return 'text-red-400';
                },
                onlineCount() {
                    return this.devices.filter(d => d.status === 'online').length;
                },
                androidCount() {
                    return this.devices.filter(d => d.type === 'Android').length;
                },
                windowsCount() {
                    return this.devices.filter(d => d.type === 'Windows').length;
                },
                otherCount() {
                    return this.devices.filter(d => !['Android', 'Windows'].includes(d.type)).length;
                },
                allCapabilities() {
                    const caps = new Set();
                    this.devices.forEach(d => {
                        if (d.capabilities) {
                            d.capabilities.forEach(c => caps.add(c));
                        }
                    });
                    return Array.from(caps);
                }
            },
            mounted() {
                this.loadDevices();
                setInterval(() => this.loadDevices(), 5000);
            },
            methods: {
                async loadDevices() {
                    const start = Date.now();
                    try {
                        const resp = await axios.get('/device/devices');
                        this.devices = resp.data.devices || [];
                        this.latency = Date.now() - start;
                        this.lastUpdate = new Date().toLocaleTimeString();
                    } catch (e) {
                        this.latency = Date.now() - start;
                        // é»˜è®¤è®¾å¤‡
                        this.devices = [
                            { id: 'master', name: 'ä¸»èŠ‚ç‚¹', type: 'Server', icon: 'ğŸ–¥ï¸', status: 'online', ip: 'localhost', latency: 5, lastSeen: 'åˆšåˆš', capabilities: ['chat', 'code', 'search'] }
                        ];
                    }
                },
                
                addDevice() {
                    const name = prompt('è®¾å¤‡åç§°:');
                    if (name) {
                        const type = prompt('è®¾å¤‡ç±»å‹;
                        this.devices.push({
                            id: 'device_' + Date.now(),
                            name: name,
                            type: type || 'Unknown',
                            icon: this.getIcon(type),
                            status: 'offline',
                            ip: '',
                            latency: null,
                            lastSeen: null,
                            capabilities: []
                        });
                        this.showToast('è®¾å¤‡å·²æ·»åŠ ', 'success');
                    }
                },
                
                getIcon(type) {
                    const icons = {
                        'Android': 'ğŸ“±',
                        'Windows': 'ğŸ’»',
                        'Linux': 'ğŸ§',
                        'Mac': 'ğŸ',
                        'Server': 'ğŸ–¥ï¸'
                    };
                    return icons[type] || 'ğŸ“¦';
                },
                
                connectDevice(device) {
                    device.status = 'online';
                    device.lastSeen = 'åˆšåˆš';
                    this.showToast(`å·²è¿æ¥åˆ° ${device.name}`, 'success');
                },
                
                removeDevice(device) {
                    this.devices = this.devices.filter(d => d.id !== device.id);
                    this.showToast(`å·²ç§»é™¤ ${device.name}`, 'success');
                },
                
                getLatencyClass(latency) {
                    if (!latency) return 'text-gray-400';
                    if (latency < 100) return 'text-green-400';
                    if (latency < 500) return 'text-yellow-400';
                    return 'text-red-400';
                },
                
                showToast(message, type) {
                    this.toast = { show: true, message, type };
                    setTimeout(() => this.toast.show = false, 3000);
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
