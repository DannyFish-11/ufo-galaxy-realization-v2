<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UFO Galaxy - è®¾å¤‡ç®¡ç†ä¸­å¿ƒ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        [v-cloak] { display: none; }
        .gradient-bg {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .device-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 40px rgba(0, 212, 255, 0.2);
        }
        .pulse-online {
            animation: pulse-green 2s infinite;
        }
        @keyframes pulse-green {
            0%, 100% { box-shadow: 0 0 0 0 rgba(0, 255, 136, 0.4); }
            50% { box-shadow: 0 0 0 8px rgba(0, 255, 136, 0); }
        }
        .scan-line {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, #00d4ff, transparent);
            animation: scan 3s linear infinite;
            pointer-events: none;
            z-index: 9999;
        }
        @keyframes scan {
            0% { top: 0; opacity: 1; }
            100% { top: 100%; opacity: 0; }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen text-white">
    <div class="scan-line"></div>
    
    <div id="app" v-cloak>
        <!-- Header -->
        <header class="border-b border-white/10">
            <div class="container mx-auto px-6 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div class="text-3xl">ğŸŒŒ</div>
                        <div>
                            <h1 class="text-2xl font-bold bg-gradient-to-r from-cyan-400 to-purple-500 bg-clip-text text-transparent">
                                UFO Galaxy
                            </h1>
                            <p class="text-sm text-gray-400">è®¾å¤‡ç®¡ç†ä¸­å¿ƒ</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-6">
                        <div class="flex items-center space-x-2">
                            <div class="w-2 h-2 rounded-full" :class="connected ? 'bg-green-400 pulse-online' : 'bg-red-400'"></div>
                            <span class="text-sm text-gray-300">{{ connected ? 'å·²è¿æ¥' : 'æœªè¿æ¥' }}</span>
                        </div>
                        <button @click="refreshAll" class="px-4 py-2 bg-cyan-600 hover:bg-cyan-700 rounded-lg text-sm transition">
                            åˆ·æ–°
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="container mx-auto px-6 py-8">
            <!-- Stats Overview -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                <div class="glass-card rounded-xl p-6">
                    <div class="text-gray-400 text-sm mb-2">æ€»è®¾å¤‡æ•°</div>
                    <div class="text-4xl font-bold text-cyan-400">{{ devices.length }}</div>
                </div>
                <div class="glass-card rounded-xl p-6">
                    <div class="text-gray-400 text-sm mb-2">åœ¨çº¿è®¾å¤‡</div>
                    <div class="text-4xl font-bold text-green-400">{{ onlineCount }}</div>
                </div>
                <div class="glass-card rounded-xl p-6">
                    <div class="text-gray-400 text-sm mb-2">ç¦»çº¿è®¾å¤‡</div>
                    <div class="text-4xl font-bold text-red-400">{{ offlineCount }}</div>
                </div>
                <div class="glass-card rounded-xl p-6">
                    <div class="text-gray-400 text-sm mb-2">æ´»è·ƒä»»åŠ¡</div>
                    <div class="text-4xl font-bold text-purple-400">{{ activeTasks }}</div>
                </div>
            </div>

            <!-- Device Registration -->
            <div class="glass-card rounded-xl p-6 mb-8">
                <h2 class="text-xl font-semibold mb-4 flex items-center">
                    <span class="mr-2">â•</span> æ³¨å†Œæ–°è®¾å¤‡
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">è®¾å¤‡ç±»å‹</label>
                        <select v-model="newDevice.type" class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white">
                            <option value="windows">Windows ç”µè„‘</option>
                            <option value="linux">Linux æœåŠ¡å™¨</option>
                            <option value="macos">macOS è®¾å¤‡</option>
                            <option value="android">Android è®¾å¤‡</option>
                            <option value="other">å…¶ä»–è®¾å¤‡</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">è®¾å¤‡åç§°</label>
                        <input v-model="newDevice.name" type="text" placeholder="æˆ‘çš„ç”µè„‘" 
                               class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white placeholder-gray-500">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">IP åœ°å€</label>
                        <input v-model="newDevice.ip" type="text" placeholder="192.168.1.100" 
                               class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white placeholder-gray-500">
                    </div>
                </div>
                <div class="mt-4">
                    <label class="block text-sm text-gray-400 mb-2">è®¾å¤‡èƒ½åŠ› (ç”¨é€—å·åˆ†éš”)</label>
                    <input v-model="newDevice.capabilities" type="text" placeholder="execute_script, send_notification, status_update" 
                           class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white placeholder-gray-500">
                </div>
                <div class="mt-4 flex justify-end">
                    <button @click="registerDevice" :disabled="registering" 
                            class="px-6 py-2 bg-gradient-to-r from-cyan-500 to-purple-500 rounded-lg font-medium hover:opacity-90 transition disabled:opacity-50">
                        {{ registering ? 'æ³¨å†Œä¸­...' : 'æ³¨å†Œè®¾å¤‡' }}
                    </button>
                </div>
            </div>

            <!-- Device List -->
            <div class="glass-card rounded-xl p-6">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-semibold flex items-center">
                        <span class="mr-2">ğŸ“±</span> å·²æ³¨å†Œè®¾å¤‡
                    </h2>
                    <div class="flex items-center space-x-4">
                        <input v-model="searchQuery" type="text" placeholder="æœç´¢è®¾å¤‡..." 
                               class="bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-sm text-white placeholder-gray-500">
                        <select v-model="filterType" class="bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-sm text-white">
                            <option value="all">å…¨éƒ¨ç±»å‹</option>
                            <option value="windows">Windows</option>
                            <option value="linux">Linux</option>
                            <option value="macos">macOS</option>
                            <option value="android">Android</option>
                        </select>
                    </div>
                </div>

                <!-- Device Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div v-for="device in filteredDevices" :key="device.device_id" 
                         class="device-card glass-card rounded-xl p-4 transition cursor-pointer"
                         @click="selectDevice(device)">
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex items-center">
                                <div class="text-2xl mr-3">{{ getDeviceIcon(device.device_type) }}</div>
                                <div>
                                    <div class="font-medium">{{ device.device_name }}</div>
                                    <div class="text-xs text-gray-400">{{ device.device_id }}</div>
                                </div>
                            </div>
                            <div class="w-3 h-3 rounded-full" :class="device.status === 'online' ? 'bg-green-400 pulse-online' : 'bg-red-400'"></div>
                        </div>
                        <div class="text-sm text-gray-400 mb-2">
                            <span class="text-gray-500">IP:</span> {{ device.ip_address }}
                        </div>
                        <div class="flex flex-wrap gap-1">
                            <span v-for="cap in device.capabilities?.slice(0, 3)" :key="cap" 
                                  class="text-xs bg-white/10 px-2 py-1 rounded">
                                {{ cap }}
                            </span>
                            <span v-if="device.capabilities?.length > 3" class="text-xs text-gray-400">
                                +{{ device.capabilities.length - 3 }}
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Empty State -->
                <div v-if="filteredDevices.length === 0" class="text-center py-12 text-gray-400">
                    <div class="text-4xl mb-4">ğŸ“­</div>
                    <div>æš‚æ— è®¾å¤‡</div>
                    <div class="text-sm mt-2">ç‚¹å‡»ä¸Šæ–¹æ³¨å†Œæ–°è®¾å¤‡</div>
                </div>
            </div>

            <!-- Device Detail Modal -->
            <div v-if="selectedDevice" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50" @click.self="selectedDevice = null">
                <div class="glass-card rounded-2xl p-6 max-w-lg w-full mx-4">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-semibold">{{ selectedDevice.device_name }}</h3>
                        <button @click="selectedDevice = null" class="text-gray-400 hover:text-white">âœ•</button>
                    </div>
                    <div class="space-y-4">
                        <div class="flex justify-between">
                            <span class="text-gray-400">è®¾å¤‡ ID</span>
                            <span class="font-mono">{{ selectedDevice.device_id }}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">ç±»å‹</span>
                            <span>{{ selectedDevice.device_type }}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">IP åœ°å€</span>
                            <span>{{ selectedDevice.ip_address }}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">çŠ¶æ€</span>
                            <span :class="selectedDevice.status === 'online' ? 'text-green-400' : 'text-red-400'">
                                {{ selectedDevice.status === 'online' ? 'åœ¨çº¿' : 'ç¦»çº¿' }}
                            </span>
                        </div>
                        <div>
                            <span class="text-gray-400 block mb-2">èƒ½åŠ›</span>
                            <div class="flex flex-wrap gap-2">
                                <span v-for="cap in selectedDevice.capabilities" :key="cap" 
                                      class="text-sm bg-cyan-500/20 text-cyan-400 px-3 py-1 rounded-full">
                                    {{ cap }}
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="mt-6 flex justify-end space-x-3">
                        <button @click="unregisterDevice(selectedDevice.device_id)" 
                                class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-sm">
                            æ³¨é”€è®¾å¤‡
                        </button>
                        <button @click="sendCommand(selectedDevice)" 
                                class="px-4 py-2 bg-cyan-600 hover:bg-cyan-700 rounded-lg text-sm">
                            å‘é€å‘½ä»¤
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="border-t border-white/10 mt-auto">
            <div class="container mx-auto px-6 py-4 text-center text-gray-400 text-sm">
                UFO Galaxy v2.0.6 - L4 çº§è‡ªä¸»æ€§æ™ºèƒ½ç³»ç»Ÿ
            </div>
        </footer>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    connected: false,
                    devices: [],
                    searchQuery: '',
                    filterType: 'all',
                    selectedDevice: null,
                    registering: false,
                    activeTasks: 0,
                    newDevice: {
                        type: 'windows',
                        name: '',
                        ip: '',
                        capabilities: ''
                    },
                    gatewayUrl: window.location.origin
                };
            },
            computed: {
                onlineCount() {
                    return this.devices.filter(d => d.status === 'online').length;
                },
                offlineCount() {
                    return this.devices.filter(d => d.status !== 'online').length;
                },
                filteredDevices() {
                    return this.devices.filter(d => {
                        const matchSearch = !this.searchQuery || 
                            d.device_name.toLowerCase().includes(this.searchQuery.toLowerCase()) ||
                            d.device_id.toLowerCase().includes(this.searchQuery.toLowerCase());
                        const matchType = this.filterType === 'all' || d.device_type === this.filterType;
                        return matchSearch && matchType;
                    });
                }
            },
            mounted() {
                this.refreshAll();
                // Auto refresh every 10 seconds
                setInterval(() => this.loadDevices(), 10000);
            },
            methods: {
                async refreshAll() {
                    await this.loadDevices();
                    this.connected = true;
                },
                async loadDevices() {
                    try {
                        const response = await axios.get(`${this.gatewayUrl}/api/devices`);
                        this.devices = response.data.devices || [];
                        this.connected = true;
                    } catch (error) {
                        console.error('Failed to load devices:', error);
                        this.connected = false;
                    }
                },
                async registerDevice() {
                    if (!this.newDevice.name || !this.newDevice.ip) {
                        alert('è¯·å¡«å†™è®¾å¤‡åç§°å’Œ IP åœ°å€');
                        return;
                    }

                    this.registering = true;
                    try {
                        const device_id = `${this.newDevice.type}_${Date.now()}`;
                        const payload = {
                            device_id: device_id,
                            device_name: this.newDevice.name,
                            device_type: this.newDevice.type,
                            aliases: [this.newDevice.name],
                            capabilities: this.newDevice.capabilities.split(',').map(c => c.trim()).filter(c => c),
                            ip_address: this.newDevice.ip
                        };

                        await axios.post(`${this.gatewayUrl}/api/devices/register`, payload);
                        alert('è®¾å¤‡æ³¨å†ŒæˆåŠŸï¼');
                        this.newDevice = { type: 'windows', name: '', ip: '', capabilities: '' };
                        await this.loadDevices();
                    } catch (error) {
                        alert('æ³¨å†Œå¤±è´¥: ' + (error.response?.data?.detail || error.message));
                    } finally {
                        this.registering = false;
                    }
                },
                async unregisterDevice(deviceId) {
                    if (!confirm('ç¡®å®šè¦æ³¨é”€æ­¤è®¾å¤‡å—ï¼Ÿ')) return;
                    
                    try {
                        await axios.delete(`${this.gatewayUrl}/api/devices/${deviceId}`);
                        this.selectedDevice = null;
                        await this.loadDevices();
                        alert('è®¾å¤‡å·²æ³¨é”€');
                    } catch (error) {
                        alert('æ³¨é”€å¤±è´¥: ' + error.message);
                    }
                },
                selectDevice(device) {
                    this.selectedDevice = device;
                },
                sendCommand(device) {
                    const command = prompt('è¾“å…¥å‘½ä»¤ (å¦‚: status, screenshot):');
                    if (!command) return;
                    
                    axios.post(`${this.gatewayUrl}/api/execute`, {
                        device_id: device.device_id,
                        command: command
                    }).then(response => {
                        alert('å‘½ä»¤å·²å‘é€: ' + JSON.stringify(response.data));
                    }).catch(error => {
                        alert('å‘é€å¤±è´¥: ' + error.message);
                    });
                },
                getDeviceIcon(type) {
                    const icons = {
                        windows: 'ğŸ’»',
                        linux: 'ğŸ§',
                        macos: 'ğŸ',
                        android: 'ğŸ“±',
                        other: 'ğŸ”Œ'
                    };
                    return icons[type] || 'ğŸ”Œ';
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
