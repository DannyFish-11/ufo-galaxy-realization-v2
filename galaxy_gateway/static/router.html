<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galaxy - AI è·¯ç”±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        [v-cloak] { display: none; }
        .gradient-bg { background: linear-gradient(135deg, #0f0f23 0%, #1a1a3e 50%, #0f0f23 100%); }
        .glass-card { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .live-dot { animation: live 2s infinite; }
        @keyframes live { 0%, 100% { box-shadow: 0 0 0 0 rgba(0, 212, 255, 0.4); } 50% { box-shadow: 0 0 0 8px rgba(0, 212, 255, 0); } }
        .bar-animate { transition: width 0.3s ease; }
    </style>
</head>
<body class="gradient-bg min-h-screen text-white">
    <div id="app" v-cloak>
        <!-- Header -->
        <header class="border-b border-white/10">
            <div class="container mx-auto px-6 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <a href="/" class="text-3xl">ğŸŒŒ</a>
                        <div>
                            <h1 class="text-2xl font-bold bg-gradient-to-r from-cyan-400 to-purple-500 bg-clip-text text-transparent">
                                AI æ™ºèƒ½è·¯ç”±
                            </h1>
                            <p class="text-sm text-gray-400">è‡ªåŠ¨é€‰æ‹©æœ€ä½³æ¨¡å‹ <span class="live-dot inline-block w-2 h-2 bg-green-400 rounded-full ml-2"></span></p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <span class="text-sm text-gray-400">æä¾›å•†: <span class="text-cyan-400">{{ providers.length }}</span></span>
                        <span class="text-sm text-gray-400">å»¶è¿Ÿ: <span :class="latencyClass">{{ latency }}ms</span></span>
                        <a href="/" class="text-gray-400 hover:text-white transition">è¿”å›</a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main -->
        <main class="container mx-auto px-6 py-8">
            <!-- Stats -->
            <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-8">
                <div class="glass-card rounded-xl p-4">
                    <div class="text-gray-400 text-xs mb-1">æ€»è°ƒç”¨</div>
                    <div class="text-2xl font-bold text-cyan-400">{{ stats.totalCalls }}</div>
                    <div class="text-xs text-gray-500 mt-1">æ›´æ–°: {{ lastUpdate }}</div>
                </div>
                <div class="glass-card rounded-xl p-4">
                    <div class="text-gray-400 text-xs mb-1">æˆåŠŸç‡</div>
                    <div class="text-2xl font-bold text-green-400">{{ (stats.successRate * 100).toFixed(1) }}%</div>
                    <div class="w-full bg-gray-700 rounded-full h-1 mt-2">
                        <div class="bg-green-400 h-1 rounded-full bar-animate" :style="{width: (stats.successRate * 100) + '%'}"></div>
                    </div>
                </div>
                <div class="glass-card rounded-xl p-4">
                    <div class="text-gray-400 text-xs mb-1">å¹³å‡å»¶è¿Ÿ</div>
                    <div class="text-2xl font-bold text-purple-400">{{ stats.avgLatency }}ms</div>
                </div>
                <div class="glass-card rounded-xl p-4">
                    <div class="text-gray-400 text-xs mb-1">å½“å‰æ¨¡å‹</div>
                    <div class="text-2xl font-bold text-yellow-400">{{ stats.currentModel }}</div>
                </div>
                <div class="glass-card rounded-xl p-4">
                    <div class="text-gray-400 text-xs mb-1">æ€»æˆæœ¬</div>
                    <div class="text-2xl font-bold text-pink-400">${{ stats.totalCost.toFixed(4) }}</div>
                </div>
            </div>

            <!-- Providers -->
            <div class="glass-card rounded-xl overflow-hidden mb-8">
                <div class="border-b border-white/10 p-4">
                    <h2 class="font-semibold">æä¾›å•†çŠ¶æ€</h2>
                </div>
                <div class="p-4">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div v-for="provider in providers" :key="provider.id" 
                             class="p-4 rounded-lg bg-white/5 hover:bg-white/10 transition"
                             :class="{'ring-2 ring-cyan-500': provider.active}">
                            <div class="flex items-center justify-between mb-3">
                                <div class="flex items-center space-x-2">
                                    <span class="text-2xl">{{ provider.icon }}</span>
                                    <div>
                                        <div class="font-medium">{{ provider.name }}</div>
                                        <div class="text-xs text-gray-400">{{ provider.model }}</div>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <span :class="['text-xs px-2 py-1 rounded', provider.status === 'online' ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400']">
                                        {{ provider.status === 'online' ? 'åœ¨çº¿' : 'ç¦»çº¿' }}
                                    </span>
                                </div>
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between text-xs">
                                    <span class="text-gray-400">å»¶è¿Ÿ</span>
                                    <span :class="getLatencyClass(provider.latency)">{{ provider.latency }}ms</span>
                                </div>
                                <div class="w-full bg-gray-700 rounded-full h-1">
                                    <div class="h-1 rounded-full bar-animate" :class="getLatencyBarClass(provider.latency)" :style="{width: Math.min(provider.latency / 10, 100) + '%'}"></div>
                                </div>
                                <div class="flex justify-between text-xs">
                                    <span class="text-gray-400">è°ƒç”¨æ¬¡æ•°</span>
                                    <span>{{ provider.calls }}</span>
                                </div>
                                <div class="flex justify-between text-xs">
                                    <span class="text-gray-400">æˆåŠŸç‡</span>
                                    <span class="text-green-400">{{ (provider.successRate * 100).toFixed(0) }}%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Calls -->
            <div class="glass-card rounded-xl overflow-hidden">
                <div class="border-b border-white/10 p-4">
                    <h2 class="font-semibold">æœ€è¿‘è°ƒç”¨</h2>
                </div>
                <div class="p-4 overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead>
                            <tr class="text-gray-400 text-left">
                                <th class="pb-3">æ—¶é—´</th>
                                <th class="pb-3">æä¾›å•†</th>
                                <th class="pb-3">æ¨¡å‹</th>
                                <th class="pb-3">ä»»åŠ¡ç±»å‹</th>
                                <th class="pb-3">å»¶è¿Ÿ</th>
                                <th class="pb-3">Tokens</th>
                                <th class="pb-3">çŠ¶æ€</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="call in recentCalls" :key="call.id" class="border-t border-white/5">
                                <td class="py-2">{{ call.time }}</td>
                                <td class="py-2">{{ call.provider }}</td>
                                <td class="py-2">{{ call.model }}</td>
                                <td class="py-2"><span class="px-2 py-0.5 rounded bg-purple-500/20 text-purple-400">{{ call.taskType }}</span></td>
                                <td class="py-2" :class="getLatencyClass(call.latency)">{{ call.latency }}ms</td>
                                <td class="py-2">{{ call.tokens }}</td>
                                <td class="py-2"><span :class="['px-2 py-0.5 rounded', call.success ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400']">{{ call.success ? 'æˆåŠŸ' : 'å¤±è´¥' }}</span></td>
                            </tr>
                        </tbody>
                    </table>
                    <div v-if="recentCalls.length === 0" class="text-center py-8 text-gray-400">
                        æš‚æ— è°ƒç”¨è®°å½•
                    </div>
                </div>
            </div>
        </main>

        <!-- Toast -->
        <div v-if="toast.show" :class="['fixed bottom-8 right-8 px-6 py-3 rounded-lg', toast.type === 'success' ? 'bg-green-600' : 'bg-red-600']">
            {{ toast.message }}
        </div>
    </div>

    <script>
        const { createApp } = Vue;
        
        createApp({
            data() {
                return {
                    latency: 0,
                    lastUpdate: '',
                    stats: { totalCalls: 0, successRate: 1, avgLatency: 0, currentModel: '-', totalCost: 0 },
                    providers: [
                        { id: 'openai', name: 'OpenAI', icon: 'ğŸ¤–', model: 'gpt-4o', status: 'online', latency: 150, calls: 0, successRate: 1, active: false },
                        { id: 'deepseek', name: 'DeepSeek', icon: 'ğŸ§ ', model: 'deepseek-chat', status: 'online', latency: 80, calls: 0, successRate: 1, active: false },
                        { id: 'anthropic', name: 'Anthropic', icon: 'ğŸ­', model: 'claude-3-5-sonnet', status: 'offline', latency: 200, calls: 0, successRate: 1, active: false },
                        { id: 'google', name: 'Google', icon: 'ğŸ”', model: 'gemini-2.0-flash', status: 'online', latency: 100, calls: 0, successRate: 1, active: false },
                        { id: 'groq', name: 'Groq', icon: 'âš¡', model: 'llama-3.1-70b', status: 'online', latency: 50, calls: 0, successRate: 1, active: false },
                        { id: 'oneapi', name: 'OneAPI', icon: 'ğŸŒ', model: 'auto', status: 'online', latency: 120, calls: 0, successRate: 1, active: true },
                    ],
                    recentCalls: [],
                    toast: { show: false, message: '', type: 'success' }
                };
            },
            computed: {
                latencyClass() {
                    if (this.latency < 100) return 'text-green-400';
                    if (this.latency < 500) return 'text-yellow-400';
                    return 'text-red-400';
                }
            },
            mounted() {
                this.loadStatus();
                this.loadProviders();
                setInterval(() => this.loadStatus(), 5000);
                setInterval(() => this.loadProviders(), 10000);
            },
            methods: {
                async loadStatus() {
                    const start = Date.now();
                    try {
                        const resp = await axios.get('/api/router/status');
                        this.stats = {
                            totalCalls: resp.data.totalCalls || 0,
                            successRate: resp.data.successRate || 1,
                            avgLatency: resp.data.avgLatency || 0,
                            currentModel: resp.data.currentModel || '-',
                            totalCost: resp.data.totalCost || 0
                        };
                        this.latency = Date.now() - start;
                        this.lastUpdate = new Date().toLocaleTimeString();
                    } catch (e) {
                        this.latency = Date.now() - start;
                    }
                },
                
                async loadProviders() {
                    try {
                        const resp = await axios.get('/api/router/providers');
                        if (resp.data.providers) {
                            this.providers = resp.data.providers;
                        }
                    } catch (e) {}
                },
                
                getLatencyClass(latency) {
                    if (latency < 100) return 'text-green-400';
                    if (latency < 500) return 'text-yellow-400';
                    return 'text-red-400';
                },
                
                getLatencyBarClass(latency) {
                    if (latency < 100) return 'bg-green-400';
                    if (latency < 500) return 'bg-yellow-400';
                    return 'bg-red-400';
                },
                
                showToast(message, type) {
                    this.toast = { show: true, message, type };
                    setTimeout(() => this.toast.show = false, 3000);
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
