<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galaxy - è®°å¿†ä¸­å¿ƒ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        [v-cloak] { display: none; }
        .gradient-bg {
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a3e 50%, #0f0f23 100%);
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .memory-card {
            transition: all 0.3s;
        }
        .memory-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 212, 255, 0.1);
        }
        .type-fact { border-left: 3px solid #00d4ff; }
        .type-preference { border-left: 3px solid #7b2cbf; }
        .type-event { border-left: 3px solid #00ff88; }
        .type-knowledge { border-left: 3px solid #ffaa00; }
    </style>
</head>
<body class="gradient-bg min-h-screen text-white">
    <div id="app" v-cloak>
        <!-- Header -->
        <header class="border-b border-white/10">
            <div class="container mx-auto px-6 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div class="text-3xl">ğŸ§ </div>
                        <div>
                            <h1 class="text-2xl font-bold bg-gradient-to-r from-cyan-400 to-purple-500 bg-clip-text text-transparent">
                                Galaxy è®°å¿†ä¸­å¿ƒ
                            </h1>
                            <p class="text-sm text-gray-400">å¯¹è¯å†å² Â· é•¿æœŸè®°å¿† Â· ç”¨æˆ·åå¥½</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <a href="/" class="text-gray-400 hover:text-white transition">æ§åˆ¶é¢æ¿</a>
                        <a href="/config" class="text-gray-400 hover:text-white transition">é…ç½®</a>
                        <a href="/devices" class="text-gray-400 hover:text-white transition">è®¾å¤‡</a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="container mx-auto px-6 py-8">
            <!-- Stats -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                <div class="glass-card rounded-xl p-6">
                    <div class="text-gray-400 text-sm mb-2">ä¼šè¯æ•°</div>
                    <div class="text-3xl font-bold text-cyan-400">{{ stats.sessions_count || 0 }}</div>
                </div>
                <div class="glass-card rounded-xl p-6">
                    <div class="text-gray-400 text-sm mb-2">æ¶ˆæ¯æ€»æ•°</div>
                    <div class="text-3xl font-bold text-green-400">{{ stats.total_messages || 0 }}</div>
                </div>
                <div class="glass-card rounded-xl p-6">
                    <div class="text-gray-400 text-sm mb-2">é•¿æœŸè®°å¿†</div>
                    <div class="text-3xl font-bold text-purple-400">{{ stats.long_term_memories_count || 0 }}</div>
                </div>
                <div class="glass-card rounded-xl p-6">
                    <div class="text-gray-400 text-sm mb-2">ç”¨æˆ·åå¥½</div>
                    <div class="text-3xl font-bold text-yellow-400">{{ stats.user_preferences_count || 0 }}</div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="flex space-x-4 mb-6">
                <button @click="activeTab = 'history'" 
                        :class="['px-4 py-2 rounded-lg transition', activeTab === 'history' ? 'bg-cyan-600' : 'bg-white/5 hover:bg-white/10']">
                    ğŸ’¬ å¯¹è¯å†å²
                </button>
                <button @click="activeTab = 'memories'" 
                        :class="['px-4 py-2 rounded-lg transition', activeTab === 'memories' ? 'bg-cyan-600' : 'bg-white/5 hover:bg-white/10']">
                    ğŸ§  é•¿æœŸè®°å¿†
                </button>
                <button @click="activeTab = 'preferences'" 
                        :class="['px-4 py-2 rounded-lg transition', activeTab === 'preferences' ? 'bg-cyan-600' : 'bg-white/5 hover:bg-white/10']">
                    âš™ï¸ ç”¨æˆ·åå¥½
                </button>
            </div>

            <!-- å¯¹è¯å†å² -->
            <div v-show="activeTab === 'history'" class="space-y-4">
                <div class="glass-card rounded-xl p-6">
                    <h2 class="text-xl font-semibold mb-4">æœ€è¿‘å¯¹è¯</h2>
                    
                    <div v-if="history.length === 0" class="text-center py-12 text-gray-400">
                        <div class="text-4xl mb-4">ğŸ’¬</div>
                        <div>æš‚æ— å¯¹è¯å†å²</div>
                        <div class="text-sm mt-2">å¼€å§‹ä¸ Galaxy å¯¹è¯ï¼Œå†å²å°†è‡ªåŠ¨ä¿å­˜</div>
                    </div>
                    
                    <div v-else class="space-y-4">
                        <div v-for="msg in history" :key="msg.timestamp" 
                             class="p-4 rounded-lg bg-white/5">
                            <div class="flex items-center justify-between mb-2">
                                <span :class="['px-2 py-1 rounded text-xs', 
                                              msg.role === 'user' ? 'bg-blue-500/20 text-blue-400' : 'bg-green-500/20 text-green-400']">
                                    {{ msg.role === 'user' ? 'ç”¨æˆ·' : 'Galaxy' }}
                                </span>
                                <span class="text-xs text-gray-500">{{ formatTime(msg.timestamp) }}</span>
                            </div>
                            <div class="text-gray-300">{{ msg.content }}</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- é•¿æœŸè®°å¿† -->
            <div v-show="activeTab === 'memories'" class="space-y-4">
                <!-- æ·»åŠ è®°å¿† -->
                <div class="glass-card rounded-xl p-6">
                    <h2 class="text-xl font-semibold mb-4">æ·»åŠ è®°å¿†</h2>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div class="md:col-span-2">
                            <input v-model="newMemory.content" type="text" 
                                   placeholder="è¾“å…¥è¦è®°ä½çš„å†…å®¹..."
                                   class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-3 text-white placeholder-gray-500 outline-none focus:border-cyan-500">
                        </div>
                        <div>
                            <select v-model="newMemory.type" class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-3 text-white outline-none">
                                <option value="fact">äº‹å®</option>
                                <option value="preference">åå¥½</option>
                                <option value="event">äº‹ä»¶</option>
                                <option value="knowledge">çŸ¥è¯†</option>
                            </select>
                        </div>
                        <div>
                            <button @click="addMemory" class="w-full bg-gradient-to-r from-cyan-500 to-purple-500 rounded-lg py-3 font-medium hover:opacity-90">
                                è®°ä½
                            </button>
                        </div>
                    </div>
                </div>

                <!-- æœç´¢è®°å¿† -->
                <div class="glass-card rounded-xl p-6">
                    <div class="flex items-center space-x-4 mb-4">
                        <input v-model="searchQuery" type="text" 
                               placeholder="æœç´¢è®°å¿†..."
                               class="flex-1 bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white placeholder-gray-500 outline-none focus:border-cyan-500"
                               @keyup.enter="searchMemories">
                        <button @click="searchMemories" class="px-6 py-2 bg-cyan-600 hover:bg-cyan-700 rounded-lg">
                            æœç´¢
                        </button>
                    </div>
                </div>

                <!-- è®°å¿†åˆ—è¡¨ -->
                <div class="glass-card rounded-xl p-6">
                    <h2 class="text-xl font-semibold mb-4">è®°å¿†åˆ—è¡¨</h2>
                    
                    <div v-if="memories.length === 0" class="text-center py-12 text-gray-400">
                        <div class="text-4xl mb-4">ğŸ§ </div>
                        <div>æš‚æ— é•¿æœŸè®°å¿†</div>
                        <div class="text-sm mt-2">æ·»åŠ è®°å¿†ï¼ŒGalaxy ä¼šè®°ä½é‡è¦çš„äº‹æƒ…</div>
                    </div>
                    
                    <div v-else class="space-y-3">
                        <div v-for="memory in memories" :key="memory.memory_id" 
                             class="memory-card p-4 rounded-lg bg-white/5"
                             :class="'type-' + memory.memory_type">
                            <div class="flex items-start justify-between">
                                <div class="flex-1">
                                    <div class="text-gray-300">{{ memory.content }}</div>
                                    <div class="flex items-center space-x-4 mt-2 text-xs text-gray-500">
                                        <span class="px-2 py-1 rounded bg-white/10">{{ memory.memory_type }}</span>
                                        <span>é‡è¦æ€§: {{ (memory.importance * 100).toFixed(0) }}%</span>
                                        <span>è®¿é—®: {{ memory.access_count }} æ¬¡</span>
                                        <span>{{ formatTime(memory.created_at) }}</span>
                                    </div>
                                </div>
                                <button @click="deleteMemory(memory.memory_id)" class="text-red-400 hover:text-red-300 ml-4">
                                    åˆ é™¤
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ç”¨æˆ·åå¥½ -->
            <div v-show="activeTab === 'preferences'" class="space-y-4">
                <div class="glass-card rounded-xl p-6">
                    <h2 class="text-xl font-semibold mb-4">æˆ‘çš„åå¥½</h2>
                    
                    <div v-if="Object.keys(preferences).length === 0" class="text-center py-12 text-gray-400">
                        <div class="text-4xl mb-4">âš™ï¸</div>
                        <div>æš‚æ— ç”¨æˆ·åå¥½</div>
                        <div class="text-sm mt-2">Galaxy ä¼šè‡ªåŠ¨å­¦ä¹ ä½ çš„åå¥½</div>
                    </div>
                    
                    <div v-else class="space-y-3">
                        <div v-for="(value, key) in preferences" :key="key" 
                             class="p-4 rounded-lg bg-white/5 flex items-center justify-between">
                            <div>
                                <div class="font-medium">{{ key }}</div>
                                <div class="text-sm text-gray-400">{{ typeof value === 'object' ? JSON.stringify(value) : value }}</div>
                            </div>
                            <button @click="deletePreference(key)" class="text-red-400 hover:text-red-300">
                                åˆ é™¤
                            </button>
                        </div>
                    </div>
                </div>

                <!-- æ·»åŠ åå¥½ -->
                <div class="glass-card rounded-xl p-6">
                    <h2 class="text-xl font-semibold mb-4">æ·»åŠ åå¥½</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <input v-model="newPref.key" type="text" placeholder="åå¥½åç§°" 
                               class="bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white placeholder-gray-500 outline-none">
                        <input v-model="newPref.value" type="text" placeholder="åå¥½å€¼" 
                               class="bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white placeholder-gray-500 outline-none">
                        <button @click="addPreference" class="bg-gradient-to-r from-cyan-500 to-purple-500 rounded-lg py-2 font-medium hover:opacity-90">
                            ä¿å­˜
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Toast -->
        <div v-if="toast.show" 
             :class="['fixed bottom-8 right-8 px-6 py-3 rounded-lg shadow-lg', 
                      toast.type === 'success' ? 'bg-green-600' : 'bg-red-600']">
            {{ toast.message }}
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    activeTab: 'history',
                    stats: {},
                    history: [],
                    memories: [],
                    preferences: {},
                    searchQuery: '',
                    newMemory: { content: '', type: 'fact' },
                    newPref: { key: '', value: '' },
                    toast: { show: false, message: '', type: 'success' }
                };
            },
            mounted() {
                this.loadStats();
                this.loadHistory();
                this.loadMemories();
                this.loadPreferences();
            },
            methods: {
                async loadStats() {
                    try {
                        const resp = await axios.get('/api/memory/stats');
                        this.stats = resp.data;
                    } catch (e) {}
                },
                async loadHistory() {
                    try {
                        const resp = await axios.get('/api/memory/history');
                        this.history = resp.data;
                    } catch (e) {}
                },
                async loadMemories() {
                    try {
                        const resp = await axios.get('/api/memory/memories');
                        this.memories = resp.data;
                    } catch (e) {}
                },
                async loadPreferences() {
                    try {
                        const resp = await axios.get('/api/memory/preferences');
                        this.preferences = resp.data;
                    } catch (e) {}
                },
                async addMemory() {
                    if (!this.newMemory.content) return;
                    
                    try {
                        await axios.post('/api/memory/memories', this.newMemory);
                        this.showToast('è®°å¿†å·²æ·»åŠ ', 'success');
                        this.newMemory.content = '';
                        this.loadMemories();
                        this.loadStats();
                    } catch (e) {
                        this.showToast('æ·»åŠ å¤±è´¥', 'error');
                    }
                },
                async searchMemories() {
                    if (!this.searchQuery) {
                        this.loadMemories();
                        return;
                    }
                    
                    try {
                        const resp = await axios.get(`/api/memory/search?q=${encodeURIComponent(this.searchQuery)}`);
                        this.memories = resp.data;
                    } catch (e) {
                        this.showToast('æœç´¢å¤±è´¥', 'error');
                    }
                },
                async deleteMemory(id) {
                    if (!confirm('ç¡®å®šåˆ é™¤è¿™æ¡è®°å¿†ï¼Ÿ')) return;
                    
                    try {
                        await axios.delete(`/api/memory/memories/${id}`);
                        this.showToast('è®°å¿†å·²åˆ é™¤', 'success');
                        this.loadMemories();
                        this.loadStats();
                    } catch (e) {
                        this.showToast('åˆ é™¤å¤±è´¥', 'error');
                    }
                },
                async addPreference() {
                    if (!this.newPref.key || !this.newPref.value) return;
                    
                    try {
                        await axios.post('/api/memory/preferences', this.newPref);
                        this.showToast('åå¥½å·²ä¿å­˜', 'success');
                        this.newPref = { key: '', value: '' };
                        this.loadPreferences();
                        this.loadStats();
                    } catch (e) {
                        this.showToast('ä¿å­˜å¤±è´¥', 'error');
                    }
                },
                async deletePreference(key) {
                    if (!confirm('ç¡®å®šåˆ é™¤è¿™ä¸ªåå¥½ï¼Ÿ')) return;
                    
                    try {
                        await axios.delete(`/api/memory/preferences/${key}`);
                        this.showToast('åå¥½å·²åˆ é™¤', 'success');
                        this.loadPreferences();
                        this.loadStats();
                    } catch (e) {
                        this.showToast('åˆ é™¤å¤±è´¥', 'error');
                    }
                },
                formatTime(timestamp) {
                    if (!timestamp) return '';
                    const date = new Date(timestamp);
                    return date.toLocaleString('zh-CN');
                },
                showToast(message, type) {
                    this.toast = { show: true, message, type };
                    setTimeout(() => { this.toast.show = false; }, 3000);
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
