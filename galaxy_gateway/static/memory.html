<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galaxy - è®°å¿†ä¸­å¿ƒ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        [v-cloak] { display: none; }
        .gradient-bg { background: linear-gradient(135deg, #0f0f23 0%, #1a1a3e 50%, #0f0f23 100%); }
        .glass-card { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .live-dot { animation: live 2s infinite; }
        @keyframes live { 0%, 100% { box-shadow: 0 0 0 0 rgba(0, 212, 255, 0.4); } 50% { box-shadow: 0 0 0 8px rgba(0, 212, 255, 0); } }
    </style>
</head>
<body class="gradient-bg min-h-screen text-white">
    <div id="app" v-cloak>
        <!-- Header -->
        <header class="border-b border-white/10">
            <div class="container mx-auto px-6 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <a href="/" class="text-3xl">ğŸŒŒ</a>
                        <div>
                            <h1 class="text-2xl font-bold bg-gradient-to-r from-cyan-400 to-purple-500 bg-clip-text text-transparent">
                                è®°å¿†ä¸­å¿ƒ
                            </h1>
                            <p class="text-sm text-gray-400">å¯¹è¯å†å²ä¸é•¿æœŸè®°å¿† <span class="live-dot inline-block w-2 h-2 bg-green-400 rounded-full ml-2"></span></p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <span class="text-sm text-gray-400">è®°å¿†: <span class="text-cyan-400">{{ memories.length }}</span> æ¡</span>
                        <span class="text-sm text-gray-400">å»¶è¿Ÿ: <span :class="latencyClass">{{ latency }}ms</span></span>
                        <a href="/" class="text-gray-400 hover:text-white transition">è¿”å›</a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main -->
        <main class="container mx-auto px-6 py-8">
            <!-- Stats -->
            <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-8">
                <div class="glass-card rounded-xl p-4">
                    <div class="text-gray-400 text-xs mb-1">æ€»è®°å¿†</div>
                    <div class="text-2xl font-bold text-cyan-400">{{ stats.total }}</div>
                    <div class="text-xs text-gray-500 mt-1">æ›´æ–°: {{ lastUpdate }}</div>
                </div>
                <div class="glass-card rounded-xl p-4">
                    <div class="text-gray-400 text-xs mb-1">å¯¹è¯å†å²</div>
                    <div class="text-2xl font-bold text-purple-400">{{ stats.conversations }}</div>
                </div>
                <div class="glass-card rounded-xl p-4">
                    <div class="text-gray-400 text-xs mb-1">é•¿æœŸè®°å¿†</div>
                    <div class="text-2xl font-bold text-green-400">{{ stats.longTerm }}</div>
                </div>
                <div class="glass-card rounded-xl p-4">
                    <div class="text-gray-400 text-xs mb-1">ç”¨æˆ·åå¥½</div>
                    <div class="text-2xl font-bold text-yellow-400">{{ stats.preferences }}</div>
                </div>
                <div class="glass-card rounded-xl p-4">
                    <div class="text-gray-400 text-xs mb-1">å­˜å‚¨å¤§å°</div>
                    <div class="text-2xl font-bold text-pink-400">{{ stats.size }}</div>
                </div>
            </div>

            <!-- Memory List -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Conversations -->
                <div class="glass-card rounded-xl overflow-hidden">
                    <div class="border-b border-white/10 p-4">
                        <h2 class="font-semibold">å¯¹è¯å†å²</h2>
                    </div>
                    <div class="p-4 space-y-2 max-h-[500px] overflow-y-auto">
                        <div v-for="conv in conversations" :key="conv.id" 
                             class="p-3 rounded-lg bg-white/5 hover:bg-white/10 cursor-pointer transition"
                             :class="{'ring-2 ring-cyan-500': conv.active}">
                            <div class="flex items-center justify-between mb-1">
                                <span class="font-medium text-sm">{{ conv.title }}</span>
                                <span class="text-xs text-gray-400">{{ conv.time }}</span>
                            </div>
                            <div class="text-xs text-gray-400">{{ conv.preview }}</div>
                            <div class="text-xs text-gray-500 mt-1">{{ conv.messages }} æ¡æ¶ˆæ¯</div>
                        </div>
                        <div v-if="conversations.length === 0" class="text-center py-8 text-gray-400">
                            æš‚æ— å¯¹è¯å†å²
                        </div>
                    </div>
                </div>

                <!-- Long Term Memory -->
                <div class="glass-card rounded-xl overflow-hidden">
                    <div class="border-b border-white/10 p-4">
                        <div class="flex items-center justify-between">
                            <h2 class="font-semibold">é•¿æœŸè®°å¿†</h2>
                            <button @click="addMemory" class="px-3 py-1 bg-cyan-600 rounded text-sm">æ·»åŠ </button>
                        </div>
                    </div>
                    <div class="p-4 space-y-2 max-h-[500px] overflow-y-auto">
                        <div v-for="mem in memories" :key="mem.id" 
                             class="p-3 rounded-lg bg-white/5 hover:bg-white/10 transition">
                            <div class="flex items-center justify-between mb-1">
                                <span class="text-xs px-2 py-0.5 rounded bg-purple-500/20 text-purple-400">{{ mem.type }}</span>
                                <span class="text-xs text-gray-400">{{ mem.time }}</span>
                            </div>
                            <div class="text-sm">{{ mem.content }}</div>
                            <div class="flex items-center justify-between mt-2">
                                <span class="text-xs text-gray-500">é‡è¦æ€§: {{ mem.importance }}</span>
                                <button @click="deleteMemory(mem)" class="text-xs text-red-400 hover:text-red-300">åˆ é™¤</button>
                            </div>
                        </div>
                        <div v-if="memories.length === 0" class="text-center py-8 text-gray-400">
                            æš‚æ— é•¿æœŸè®°å¿†
                        </div>
                    </div>
                </div>

                <!-- Preferences -->
                <div class="glass-card rounded-xl overflow-hidden">
                    <div class="border-b border-white/10 p-4">
                        <h2 class="font-semibold">ç”¨æˆ·åå¥½</h2>
                    </div>
                    <div class="p-4 space-y-3">
                        <div v-for="pref in preferences" :key="pref.key" 
                             class="flex items-center justify-between p-3 rounded-lg bg-white/5">
                            <div>
                                <div class="font-medium text-sm">{{ pref.key }}</div>
                                <div class="text-xs text-gray-400">{{ pref.description }}</div>
                            </div>
                            <input v-model="pref.value" 
                                   @change="savePreference(pref)"
                                   class="w-32 bg-white/5 border border-white/10 rounded px-2 py-1 text-sm outline-none focus:border-cyan-500">
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Toast -->
        <div v-if="toast.show" :class="['fixed bottom-8 right-8 px-6 py-3 rounded-lg', toast.type === 'success' ? 'bg-green-600' : 'bg-red-600']">
            {{ toast.message }}
        </div>
    </div>

    <script>
        const { createApp } = Vue;
        
        createApp({
            data() {
                return {
                    latency: 0,
                    lastUpdate: '',
                    stats: { total: 0, conversations: 0, longTerm: 0, preferences: 0, size: '0 KB' },
                    conversations: [],
                    memories: [],
                    preferences: [
                        { key: 'language', value: 'ä¸­æ–‡', description: 'é¦–é€‰è¯­è¨€' },
                        { key: 'model', value: 'gpt-4o', description: 'é»˜è®¤æ¨¡å‹' },
                        { key: 'temperature', value: '0.7', description: 'æ¸©åº¦å‚æ•°' },
                    ],
                    toast: { show: false, message: '', type: 'success' }
                };
            },
            computed: {
                latencyClass() {
                    if (this.latency < 100) return 'text-green-400';
                    if (this.latency < 500) return 'text-yellow-400';
                    return 'text-red-400';
                }
            },
            mounted() {
                this.loadStats();
                this.loadConversations();
                this.loadMemories();
                setInterval(() => this.loadStats(), 5000);
            },
            methods: {
                async loadStats() {
                    const start = Date.now();
                    try {
                        const resp = await axios.get('/api/memory/stats');
                        this.stats = resp.data;
                        this.latency = Date.now() - start;
                        this.lastUpdate = new Date().toLocaleTimeString();
                    } catch (e) {
                        this.latency = Date.now() - start;
                        // ä½¿ç”¨é»˜è®¤å€¼
                        this.stats = { total: this.memories.length, conversations: this.conversations.length, longTerm: this.memories.length, preferences: this.preferences.length, size: '0 KB' };
                    }
                },
                
                async loadConversations() {
                    try {
                        const resp = await axios.get('/api/memory/conversations');
                        this.conversations = resp.data.conversations || [];
                    } catch (e) {
                        this.conversations = [];
                    }
                },
                
                async loadMemories() {
                    try {
                        const resp = await axios.get('/api/memory/list');
                        this.memories = resp.data.memories || [];
                    } catch (e) {
                        this.memories = [];
                    }
                },
                
                addMemory() {
                    const content = prompt('è¾“å…¥è®°å¿†å†…å®¹:');
                    if (content) {
                        this.memories.unshift({
                            id: Date.now(),
                            type: 'fact',
                            content: content,
                            time: new Date().toLocaleTimeString(),
                            importance: 0.5
                        });
                        this.showToast('è®°å¿†å·²æ·»åŠ ', 'success');
                    }
                },
                
                deleteMemory(mem) {
                    this.memories = this.memories.filter(m => m.id !== mem.id);
                    this.showToast('è®°å¿†å·²åˆ é™¤', 'success');
                },
                
                savePreference(pref) {
                    this.showToast(`${pref.key} å·²ä¿å­˜`, 'success');
                },
                
                showToast(message, type) {
                    this.toast = { show: true, message, type };
                    setTimeout(() => this.toast.show = false, 3000);
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
