<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galaxy - æ§åˆ¶ä¸­å¿ƒ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        [v-cloak] { display: none; }
        .gradient-bg {
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a3e 50%, #0f0f23 100%);
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .pulse-dot {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .chat-container {
            height: calc(100vh - 300px);
            min-height: 300px;
        }
        .message-user {
            background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
        }
        .message-assistant {
            background: rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body class="gradient-bg min-h-screen text-white">
    <div id="app" v-cloak>
        <!-- Header -->
        <header class="border-b border-white/10">
            <div class="container mx-auto px-6 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div class="text-3xl">ğŸŒŒ</div>
                        <div>
                            <h1 class="text-2xl font-bold bg-gradient-to-r from-cyan-400 to-purple-500 bg-clip-text text-transparent">
                                Galaxy
                            </h1>
                            <p class="text-sm text-gray-400">L4 çº§è‡ªä¸»æ€§æ™ºèƒ½ç³»ç»Ÿ</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="flex items-center space-x-2">
                            <span class="pulse-dot w-2 h-2 rounded-full" :class="status === 'running' ? 'bg-green-400' : 'bg-red-400'"></span>
                            <span class="text-sm text-gray-400">{{ statusText }}</span>
                        </div>
                        <a href="/config" class="text-gray-400 hover:text-white transition">é…ç½®</a>
                        <a href="/api-keys" class="text-gray-400 hover:text-white transition">API Key</a>
                        <a href="/docs" class="text-gray-400 hover:text-white transition">API</a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="container mx-auto px-6 py-8">
            <!-- Stats -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                <div class="glass-card rounded-xl p-6">
                    <div class="text-gray-400 text-sm mb-2">æœåŠ¡çŠ¶æ€</div>
                    <div class="text-2xl font-bold" :class="status === 'running' ? 'text-green-400' : 'text-red-400'">
                        {{ statusText }}
                    </div>
                </div>
                <div class="glass-card rounded-xl p-6">
                    <div class="text-gray-400 text-sm mb-2">åœ¨çº¿èŠ‚ç‚¹</div>
                    <div class="text-2xl font-bold text-cyan-400">{{ nodes.online }}/{{ nodes.total }}</div>
                </div>
                <div class="glass-card rounded-xl p-6">
                    <div class="text-gray-400 text-sm mb-2">å¯¹è¯æ•°é‡</div>
                    <div class="text-2xl font-bold text-purple-400">{{ conversations }}</div>
                </div>
                <div class="glass-card rounded-xl p-6">
                    <div class="text-gray-400 text-sm mb-2">ç‰ˆæœ¬</div>
                    <div class="text-2xl font-bold text-yellow-400">{{ version }}</div>
                </div>
            </div>

            <!-- Chat Interface -->
            <div class="glass-card rounded-xl overflow-hidden">
                <!-- Chat Header -->
                <div class="border-b border-white/10 p-4">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="text-xl">ğŸ’¬</div>
                            <div>
                                <h2 class="font-semibold">æ™ºèƒ½å¯¹è¯</h2>
                                <p class="text-sm text-gray-400">å®æ—¶äº¤äº’ï¼Œæ”¯æŒè¯­éŸ³è¾“å…¥</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button @click="clearChat" class="px-3 py-1.5 bg-white/10 hover:bg-white/20 rounded-lg text-sm">
                                æ¸…ç©ºå¯¹è¯
                            </button>
                            <button @click="toggleVoice" :class="['px-3 py-1.5 rounded-lg text-sm', voiceEnabled ? 'bg-cyan-600' : 'bg-white/10 hover:bg-white/20']">
                                {{ voiceEnabled ? 'ğŸ¤ è¯­éŸ³å¼€' : 'ğŸ¤ è¯­éŸ³å…³' }}
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Chat Messages -->
                <div class="chat-container overflow-y-auto p-4 space-y-4" ref="chatContainer">
                    <div v-if="messages.length === 0" class="text-center py-12 text-gray-400">
                        <div class="text-4xl mb-4">ğŸŒŒ</div>
                        <div>å¼€å§‹ä¸ Galaxy å¯¹è¯å§</div>
                        <div class="text-sm mt-2">è¾“å…¥æ¶ˆæ¯æˆ–ç‚¹å‡»è¯­éŸ³æŒ‰é’®</div>
                    </div>
                    
                    <div v-for="(msg, index) in messages" :key="index" 
                         :class="['flex', msg.role === 'user' ? 'justify-end' : 'justify-start']">
                        <div :class="['max-w-[80%] rounded-2xl px-4 py-3', 
                                     msg.role === 'user' ? 'message-user text-white' : 'message-assistant text-white']">
                            <div v-if="msg.role === 'assistant'" class="flex items-center space-x-2 mb-1">
                                <span class="text-xs text-cyan-400">Galaxy</span>
                                <span class="text-xs text-gray-500">{{ msg.time }}</span>
                            </div>
                            <div class="whitespace-pre-wrap">{{ msg.content }}</div>
                            <div v-if="msg.role === 'user'" class="text-xs text-white/60 mt-1 text-right">
                                {{ msg.time }}
                            </div>
                        </div>
                    </div>
                    
                    <div v-if="loading" class="flex justify-start">
                        <div class="message-assistant rounded-2xl px-4 py-3">
                            <div class="flex items-center space-x-2">
                                <div class="animate-spin w-4 h-4 border-2 border-cyan-400 border-t-transparent rounded-full"></div>
                                <span class="text-gray-400">æ€è€ƒä¸­...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chat Input -->
                <div class="border-t border-white/10 p-4">
                    <div class="flex items-center space-x-4">
                        <div class="flex-1 relative">
                            <input v-model="inputMessage" 
                                   @keyup.enter="sendMessage"
                                   type="text" 
                                   placeholder="è¾“å…¥æ¶ˆæ¯..." 
                                   class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-500 outline-none focus:border-cyan-500">
                        </div>
                        <button v-if="voiceEnabled" @click="startVoiceInput" 
                                :class="['p-3 rounded-xl transition', isRecording ? 'bg-red-600 animate-pulse' : 'bg-white/10 hover:bg-white/20']">
                            ğŸ¤
                        </button>
                        <button @click="sendMessage" 
                                :disabled="!inputMessage.trim() || loading"
                                :class="['px-6 py-3 rounded-xl font-medium transition', 
                                         inputMessage.trim() && !loading ? 'bg-cyan-600 hover:bg-cyan-700' : 'bg-gray-600 cursor-not-allowed']">
                            å‘é€
                        </button>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="mt-8">
                <h3 class="text-lg font-semibold mb-4">å¿«æ·æ“ä½œ</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <button @click="quickAction('æˆªå›¾')" class="glass-card rounded-xl p-4 hover:bg-white/10 transition text-left">
                        <div class="text-2xl mb-2">ğŸ“¸</div>
                        <div class="font-medium">æˆªå›¾</div>
                        <div class="text-sm text-gray-400">æˆªå–å±å¹•å†…å®¹</div>
                    </button>
                    <button @click="quickAction('æœç´¢')" class="glass-card rounded-xl p-4 hover:bg-white/10 transition text-left">
                        <div class="text-2xl mb-2">ğŸ”</div>
                        <div class="font-medium">æœç´¢</div>
                        <div class="text-sm text-gray-400">æœç´¢ç½‘ç»œä¿¡æ¯</div>
                    </button>
                    <button @click="quickAction('ç¿»è¯‘')" class="glass-card rounded-xl p-4 hover:bg-white/10 transition text-left">
                        <div class="text-2xl mb-2">ğŸŒ</div>
                        <div class="font-medium">ç¿»è¯‘</div>
                        <div class="text-sm text-gray-400">ç¿»è¯‘æ–‡æœ¬å†…å®¹</div>
                    </button>
                    <button @click="quickAction('ä»£ç ')" class="glass-card rounded-xl p-4 hover:bg-white/10 transition text-left">
                        <div class="text-2xl mb-2">ğŸ’»</div>
                        <div class="font-medium">ä»£ç </div>
                        <div class="text-sm text-gray-400">ç”Ÿæˆæˆ–è§£é‡Šä»£ç </div>
                    </button>
                </div>
            </div>
        </main>

        <!-- Toast -->
        <div v-if="toast.show" 
             :class="['fixed bottom-8 right-8 px-6 py-3 rounded-lg shadow-lg', 
                      toast.type === 'success' ? 'bg-green-600' : 'bg-red-600']">
            {{ toast.message }}
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    status: 'unknown',
                    statusText: 'æ£€æµ‹ä¸­...',
                    nodes: { online: 0, total: 0 },
                    conversations: 0,
                    version: '2.1.7',
                    
                    messages: [],
                    inputMessage: '',
                    loading: false,
                    voiceEnabled: true,
                    isRecording: false,
                    
                    toast: { show: false, message: '', type: 'success' }
                };
            },
            mounted() {
                this.loadStatus();
                this.loadNodes();
                // å®šæ—¶åˆ·æ–°çŠ¶æ€
                setInterval(() => {
                    this.loadStatus();
                    this.loadNodes();
                }, 10000);
            },
            methods: {
                async loadStatus() {
                    try {
                        const resp = await axios.get('/api/status');
                        this.status = resp.data.status;
                        this.statusText = this.status === 'running' ? 'è¿è¡Œä¸­' : 'å·²åœæ­¢';
                        this.version = resp.data.version || this.version;
                    } catch (e) {
                        this.status = 'error';
                        this.statusText = 'è¿æ¥å¤±è´¥';
                    }
                },
                
                async loadNodes() {
                    try {
                        const resp = await axios.get('/api/nodes/status');
                        this.nodes = {
                            online: resp.data.online || 0,
                            total: resp.data.total || 0
                        };
                    } catch (e) {}
                },
                
                async sendMessage() {
                    if (!this.inputMessage.trim() || this.loading) return;
                    
                    const message = this.inputMessage.trim();
                    this.inputMessage = '';
                    
                    // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
                    this.messages.push({
                        role: 'user',
                        content: message,
                        time: new Date().toLocaleTimeString()
                    });
                    
                    this.scrollToBottom();
                    this.loading = true;
                    
                    try {
                        // è°ƒç”¨ AI è·¯ç”±
                        const resp = await axios.post('/api/router/chat', {
                            messages: [{ role: 'user', content: message }],
                            optimize_for: 'balanced'
                        });
                        
                        // æ·»åŠ åŠ©æ‰‹æ¶ˆæ¯
                        this.messages.push({
                            role: 'assistant',
                            content: resp.data.content || resp.data.response || 'å¤„ç†å®Œæˆ',
                            time: new Date().toLocaleTimeString()
                        });
                        
                        this.conversations++;
                    } catch (e) {
                        // å¦‚æœ API ä¸å­˜åœ¨ï¼Œæ¨¡æ‹Ÿå“åº”
                        this.messages.push({
                            role: 'assistant',
                            content: this.mockResponse(message),
                            time: new Date().toLocaleTimeString()
                        });
                    }
                    
                    this.loading = false;
                    this.scrollToBottom();
                },
                
                mockResponse(message) {
                    // æ¨¡æ‹Ÿå“åº”
                    const responses = {
                        'æˆªå›¾': 'å¥½çš„ï¼Œæ­£åœ¨ä¸ºæ‚¨æˆªå›¾...\n\næˆªå›¾åŠŸèƒ½éœ€è¦è¿æ¥åˆ°è®¾å¤‡èŠ‚ç‚¹æ‰èƒ½ä½¿ç”¨ã€‚è¯·ç¡®ä¿å·²é…ç½®ç›¸å…³è®¾å¤‡ã€‚',
                        'æœç´¢': 'è¯·å‘Šè¯‰æˆ‘æ‚¨æƒ³æœç´¢ä»€ä¹ˆå†…å®¹ï¼Ÿ',
                        'ç¿»è¯‘': 'è¯·æä¾›éœ€è¦ç¿»è¯‘çš„æ–‡æœ¬ï¼Œæˆ‘ä¼šä¸ºæ‚¨ç¿»è¯‘ã€‚',
                        'ä»£ç ': 'è¯·æè¿°æ‚¨éœ€è¦çš„ä»£ç åŠŸèƒ½ï¼Œæˆ‘ä¼šå¸®æ‚¨ç”Ÿæˆã€‚',
                    };
                    
                    for (const [key, value] of Object.entries(responses)) {
                        if (message.includes(key)) {
                            return value;
                        }
                    }
                    
                    return `æ”¶åˆ°æ‚¨çš„æ¶ˆæ¯ï¼š"${message}"\n\næˆ‘å·²ç†è§£æ‚¨çš„éœ€æ±‚ã€‚å¦‚éœ€æ›´å®Œæ•´çš„åŠŸèƒ½ï¼Œè¯·é…ç½® API Key åä½¿ç”¨ã€‚`;
                },
                
                quickAction(action) {
                    this.inputMessage = action;
                    this.sendMessage();
                },
                
                clearChat() {
                    this.messages = [];
                    this.conversations = 0;
                    this.showToast('å¯¹è¯å·²æ¸…ç©º', 'success');
                },
                
                toggleVoice() {
                    this.voiceEnabled = !this.voiceEnabled;
                    this.showToast(this.voiceEnabled ? 'è¯­éŸ³å·²å¼€å¯' : 'è¯­éŸ³å·²å…³é—­', 'success');
                },
                
                startVoiceInput() {
                    if (this.isRecording) return;
                    
                    this.isRecording = true;
                    this.showToast('æ­£åœ¨å½•éŸ³...', 'success');
                    
                    // æ¨¡æ‹Ÿè¯­éŸ³è¯†åˆ«
                    setTimeout(() => {
                        this.isRecording = false;
                        this.inputMessage = 'è¿™æ˜¯è¯­éŸ³è¾“å…¥çš„æµ‹è¯•å†…å®¹';
                        this.showToast('è¯­éŸ³è¯†åˆ«å®Œæˆ', 'success');
                    }, 2000);
                },
                
                scrollToBottom() {
                    this.$nextTick(() => {
                        const container = this.$refs.chatContainer;
                        if (container) {
                            container.scrollTop = container.scrollHeight;
                        }
                    });
                },
                
                showToast(message, type) {
                    this.toast = { show: true, message, type };
                    setTimeout(() => { this.toast.show = false; }, 3000);
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
