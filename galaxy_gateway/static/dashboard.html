<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galaxy - æ§åˆ¶ä¸­å¿ƒ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        [v-cloak] { display: none; }
        .gradient-bg {
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a3e 50%, #0f0f23 100%);
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .pulse-dot {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .chat-container {
            height: calc(100vh - 350px);
            min-height: 400px;
        }
        .message-user {
            background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
        }
        .message-assistant {
            background: rgba(255, 255, 255, 0.1);
        }
        .thinking {
            animation: thinking 1.5s infinite;
        }
        @keyframes thinking {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        .capability-card {
            transition: all 0.3s;
        }
        .capability-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 212, 255, 0.1);
        }
    </style>
</head>
<body class="gradient-bg min-h-screen text-white">
    <div id="app" v-cloak>
        <!-- Header -->
        <header class="border-b border-white/10">
            <div class="container mx-auto px-6 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div class="text-3xl">ğŸŒŒ</div>
                        <div>
                            <h1 class="text-2xl font-bold bg-gradient-to-r from-cyan-400 to-purple-500 bg-clip-text text-transparent">
                                Galaxy
                            </h1>
                            <p class="text-sm text-gray-400">L4 çº§ç¾¤æ™ºèƒ½ç³»ç»Ÿ</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-6">
                        <div class="flex items-center space-x-2">
                            <span class="pulse-dot w-2 h-2 rounded-full" :class="swarmState === 'active' ? 'bg-green-400' : 'bg-yellow-400'"></span>
                            <span class="text-sm text-gray-400">{{ swarmStateText }}</span>
                        </div>
                        <div class="text-sm text-gray-400">
                            èƒ½åŠ›: <span class="text-cyan-400">{{ capabilitiesCount }}</span>
                        </div>
                        <a href="/capabilities" class="text-gray-400 hover:text-white transition">èƒ½åŠ›ä¸­å¿ƒ</a>
                        <a href="/api-keys" class="text-gray-400 hover:text-white transition">é…ç½®</a>
                        <a href="/docs" class="text-gray-400 hover:text-white transition">API</a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="container mx-auto px-6 py-6">
            <!-- Stats -->
            <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">
                <div class="glass-card rounded-xl p-4">
                    <div class="text-gray-400 text-xs mb-1">ç³»ç»ŸçŠ¶æ€</div>
                    <div class="text-xl font-bold" :class="swarmState === 'active' ? 'text-green-400' : 'text-yellow-400'">
                        {{ swarmStateText }}
                    </div>
                </div>
                <div class="glass-card rounded-xl p-4">
                    <div class="text-gray-400 text-xs mb-1">å¯ç”¨èƒ½åŠ›</div>
                    <div class="text-xl font-bold text-cyan-400">{{ capabilitiesCount }}</div>
                </div>
                <div class="glass-card rounded-xl p-4">
                    <div class="text-gray-400 text-xs mb-1">äº¤äº’æ¬¡æ•°</div>
                    <div class="text-xl font-bold text-purple-400">{{ stats.total_interactions }}</div>
                </div>
                <div class="glass-card rounded-xl p-4">
                    <div class="text-gray-400 text-xs mb-1">æˆåŠŸç‡</div>
                    <div class="text-xl font-bold text-green-400">{{ (stats.success_rate * 100).toFixed(1) }}%</div>
                </div>
                <div class="glass-card rounded-xl p-4">
                    <div class="text-gray-400 text-xs mb-1">ç‰ˆæœ¬</div>
                    <div class="text-xl font-bold text-yellow-400">{{ version }}</div>
                </div>
            </div>

            <!-- Main Interface -->
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                <!-- Chat Interface -->
                <div class="lg:col-span-3 glass-card rounded-xl overflow-hidden">
                    <!-- Chat Header -->
                    <div class="border-b border-white/10 p-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <div class="text-xl">ğŸ’¬</div>
                                <div>
                                    <h2 class="font-semibold">ç¾¤æ™ºèƒ½äº¤äº’</h2>
                                    <p class="text-xs text-gray-400">ç»Ÿä¸€å…¥å£ï¼Œæ™ºèƒ½è·¯ç”±</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button @click="clearChat" class="px-3 py-1.5 bg-white/10 hover:bg-white/20 rounded-lg text-sm">
                                    æ¸…ç©º
                                </button>
                                <button @click="toggleVoice" :class="['px-3 py-1.5 rounded-lg text-sm', voiceEnabled ? 'bg-cyan-600' : 'bg-white/10 hover:bg-white/20']">
                                    {{ voiceEnabled ? 'ğŸ¤ å¼€' : 'ğŸ¤ å…³' }}
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Chat Messages -->
                    <div class="chat-container overflow-y-auto p-4 space-y-4" ref="chatContainer">
                        <div v-if="messages.length === 0" class="text-center py-16 text-gray-400">
                            <div class="text-5xl mb-4">ğŸŒŒ</div>
                            <div class="text-lg mb-2">Galaxy ç¾¤æ™ºèƒ½ç³»ç»Ÿ</div>
                            <div class="text-sm">ä¸€ä¸ªæœ‰æœºçš„æ•´ä½“ï¼Œä¸æ˜¯ä¸€å †ç‹¬ç«‹çš„æœåŠ¡</div>
                            <div class="text-sm mt-4 text-gray-500">è¾“å…¥æ¶ˆæ¯å¼€å§‹äº¤äº’</div>
                        </div>
                        
                        <div v-for="(msg, index) in messages" :key="index" 
                             :class="['flex', msg.role === 'user' ? 'justify-end' : 'justify-start']">
                            <div :class="['max-w-[85%] rounded-2xl px-4 py-3', 
                                         msg.role === 'user' ? 'message-user text-white' : 'message-assistant text-white']">
                                <div v-if="msg.role === 'assistant'" class="flex items-center space-x-2 mb-1">
                                    <span class="text-xs text-cyan-400">Galaxy</span>
                                    <span v-if="msg.capability" class="text-xs px-1.5 py-0.5 bg-cyan-500/20 rounded">{{ msg.capability }}</span>
                                    <span class="text-xs text-gray-500">{{ msg.time }}</span>
                                </div>
                                <div class="whitespace-pre-wrap">{{ msg.content }}</div>
                                <div v-if="msg.role === 'user'" class="text-xs text-white/60 mt-1 text-right">
                                    {{ msg.time }}
                                </div>
                            </div>
                        </div>
                        
                        <div v-if="loading" class="flex justify-start">
                            <div class="message-assistant rounded-2xl px-4 py-3">
                                <div class="flex items-center space-x-2">
                                    <div class="thinking flex space-x-1">
                                        <span class="w-2 h-2 bg-cyan-400 rounded-full"></span>
                                        <span class="w-2 h-2 bg-cyan-400 rounded-full" style="animation-delay: 0.2s"></span>
                                        <span class="w-2 h-2 bg-cyan-400 rounded-full" style="animation-delay: 0.4s"></span>
                                    </div>
                                    <span class="text-gray-400 text-sm">{{ thinkingText }}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Chat Input -->
                    <div class="border-t border-white/10 p-4">
                        <div class="flex items-center space-x-4">
                            <div class="flex-1 relative">
                                <input v-model="inputMessage" 
                                       @keyup.enter="sendMessage"
                                       type="text" 
                                       placeholder="è¾“å…¥æ¶ˆæ¯ï¼ŒGalaxy ä¼šè‡ªåŠ¨ç†è§£å¹¶æ‰§è¡Œ..." 
                                       class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-500 outline-none focus:border-cyan-500">
                            </div>
                            <button v-if="voiceEnabled" @click="startVoiceInput" 
                                    :class="['p-3 rounded-xl transition', isRecording ? 'bg-red-600 animate-pulse' : 'bg-white/10 hover:bg-white/20']">
                                ğŸ¤
                            </button>
                            <button @click="sendMessage" 
                                    :disabled="!inputMessage.trim() || loading"
                                    :class="['px-6 py-3 rounded-xl font-medium transition', 
                                             inputMessage.trim() && !loading ? 'bg-cyan-600 hover:bg-cyan-700' : 'bg-gray-600 cursor-not-allowed']">
                                å‘é€
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Capabilities Panel -->
                <div class="glass-card rounded-xl overflow-hidden">
                    <div class="border-b border-white/10 p-4">
                        <h3 class="font-semibold">èƒ½åŠ›æ± </h3>
                        <p class="text-xs text-gray-400">åŠ¨æ€å‘ç°å’Œè°ƒç”¨</p>
                    </div>
                    <div class="p-4 space-y-2 max-h-[500px] overflow-y-auto">
                        <div v-for="cap in capabilities" :key="cap.id" 
                             class="capability-card p-3 rounded-lg bg-white/5 hover:bg-white/10 cursor-pointer"
                             @click="useCapability(cap)">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="font-medium text-sm">{{ cap.name }}</div>
                                    <div class="text-xs text-gray-400">{{ cap.description }}</div>
                                </div>
                                <span class="text-xs px-2 py-1 rounded" 
                                      :class="getCategoryColor(cap.category)">
                                    {{ cap.category }}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="mt-6">
                <h3 class="text-lg font-semibold mb-4">å¿«æ·æ“ä½œ</h3>
                <div class="grid grid-cols-2 md:grid-cols-6 gap-4">
                    <button v-for="action in quickActions" :key="action.name" 
                            @click="quickAction(action)"
                            class="glass-card rounded-xl p-4 hover:bg-white/10 transition text-left">
                        <div class="text-2xl mb-2">{{ action.icon }}</div>
                        <div class="font-medium text-sm">{{ action.name }}</div>
                        <div class="text-xs text-gray-400">{{ action.desc }}</div>
                    </button>
                </div>
            </div>
        </main>

        <!-- Toast -->
        <div v-if="toast.show" 
             :class="['fixed bottom-8 right-8 px-6 py-3 rounded-lg shadow-lg', 
                      toast.type === 'success' ? 'bg-green-600' : 'bg-red-600']">
            {{ toast.message }}
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    version: '2.1.10',
                    swarmState: 'unknown',
                    swarmStateText: 'æ£€æµ‹ä¸­...',
                    capabilitiesCount: 0,
                    stats: {
                        total_interactions: 0,
                        success_rate: 1
                    },
                    
                    messages: [],
                    inputMessage: '',
                    loading: false,
                    thinkingText: 'æ€è€ƒä¸­...',
                    voiceEnabled: true,
                    isRecording: false,
                    
                    capabilities: [],
                    
                    quickActions: [
                        { name: 'å¯¹è¯', icon: 'ğŸ’¬', desc: 'æ™ºèƒ½å¯¹è¯', prompt: 'ä½ å¥½' },
                        { name: 'æœç´¢', icon: 'ğŸ”', desc: 'ä¿¡æ¯æœç´¢', prompt: 'å¸®æˆ‘æœç´¢' },
                        { name: 'ä»£ç ', icon: 'ğŸ’»', desc: 'ä»£ç ç”Ÿæˆ', prompt: 'å¸®æˆ‘å†™ä»£ç ' },
                        { name: 'ç¿»è¯‘', icon: 'ğŸŒ', desc: 'æ–‡æœ¬ç¿»è¯‘', prompt: 'å¸®æˆ‘ç¿»è¯‘' },
                        { name: 'åˆ†æ', icon: 'ğŸ“Š', desc: 'æ•°æ®åˆ†æ', prompt: 'å¸®æˆ‘åˆ†æ' },
                        { name: 'æ€»ç»“', icon: 'ğŸ“', desc: 'å†…å®¹æ€»ç»“', prompt: 'å¸®æˆ‘æ€»ç»“' }
                    ],
                    
                    toast: { show: false, message: '', type: 'success' }
                };
            },
            mounted() {
                this.loadStatus();
                this.loadCapabilities();
                
                // å®šæ—¶åˆ·æ–°
                setInterval(() => {
                    this.loadStatus();
                }, 10000);
            },
            methods: {
                async loadStatus() {
                    try {
                        const resp = await axios.get('/api/swarm/status');
                        this.swarmState = resp.data.state;
                        this.swarmStateText = this.getStateText(resp.data.state);
                        this.capabilitiesCount = resp.data.capabilities;
                        this.stats = resp.data.stats || this.stats;
                    } catch (e) {
                        // å°è¯•å¤‡ç”¨æ¥å£
                        try {
                            const resp = await axios.get('/api/status');
                            this.swarmState = 'active';
                            this.swarmStateText = 'è¿è¡Œä¸­';
                        } catch (e2) {
                            this.swarmState = 'error';
                            this.swarmStateText = 'è¿æ¥å¤±è´¥';
                        }
                    }
                },
                
                async loadCapabilities() {
                    try {
                        const resp = await axios.get('/api/swarm/capabilities');
                        this.capabilities = resp.data.capabilities.slice(0, 10);
                    } catch (e) {
                        // ä½¿ç”¨é»˜è®¤èƒ½åŠ›
                        this.capabilities = [
                            { id: 'chat', name: 'æ™ºèƒ½å¯¹è¯', description: 'è‡ªç„¶è¯­è¨€å¯¹è¯', category: 'llm' },
                            { id: 'search', name: 'ä¿¡æ¯æœç´¢', description: 'æœç´¢ç½‘ç»œä¿¡æ¯', category: 'search' },
                            { id: 'code', name: 'ä»£ç ç”Ÿæˆ', description: 'ç”Ÿæˆä»£ç ', category: 'code' },
                            { id: 'translate', name: 'æ–‡æœ¬ç¿»è¯‘', description: 'ç¿»è¯‘æ–‡æœ¬', category: 'language' }
                        ];
                    }
                },
                
                getStateText(state) {
                    const states = {
                        'dormant': 'ä¼‘çœ ',
                        'awakening': 'å”¤é†’ä¸­',
                        'active': 'è¿è¡Œä¸­',
                        'thinking': 'æ€è€ƒä¸­',
                        'executing': 'æ‰§è¡Œä¸­',
                        'learning': 'å­¦ä¹ ä¸­'
                    };
                    return states[state] || state;
                },
                
                getCategoryColor(category) {
                    const colors = {
                        'llm': 'bg-purple-500/20 text-purple-400',
                        'search': 'bg-blue-500/20 text-blue-400',
                        'code': 'bg-green-500/20 text-green-400',
                        'language': 'bg-yellow-500/20 text-yellow-400',
                        'analysis': 'bg-pink-500/20 text-pink-400',
                        'node': 'bg-cyan-500/20 text-cyan-400'
                    };
                    return colors[category] || 'bg-gray-500/20 text-gray-400';
                },
                
                async sendMessage() {
                    if (!this.inputMessage.trim() || this.loading) return;
                    
                    const message = this.inputMessage.trim();
                    this.inputMessage = '';
                    
                    // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
                    this.messages.push({
                        role: 'user',
                        content: message,
                        time: new Date().toLocaleTimeString()
                    });
                    
                    this.scrollToBottom();
                    this.loading = true;
                    this.thinkingText = 'æ„ŸçŸ¥ä¸­...';
                    
                    try {
                        // è°ƒç”¨ç¾¤æ™ºèƒ½æ¥å£
                        const resp = await axios.post('/api/swarm/interact', {
                            input: message
                        });
                        
                        // æ·»åŠ åŠ©æ‰‹æ¶ˆæ¯
                        this.messages.push({
                            role: 'assistant',
                            content: resp.data.response,
                            capability: resp.data.capability,
                            time: new Date().toLocaleTimeString()
                        });
                        
                    } catch (e) {
                        // å¤‡ç”¨æ¥å£
                        try {
                            const resp = await axios.post('/api/router/chat', {
                                messages: [{ role: 'user', content: message }]
                            });
                            
                            this.messages.push({
                                role: 'assistant',
                                content: resp.data.content,
                                time: new Date().toLocaleTimeString()
                            });
                        } catch (e2) {
                            // æ¨¡æ‹Ÿå“åº”
                            this.messages.push({
                                role: 'assistant',
                                content: this.mockResponse(message),
                                time: new Date().toLocaleTimeString()
                            });
                        }
                    }
                    
                    this.loading = false;
                    this.scrollToBottom();
                    this.loadStatus();
                },
                
                mockResponse(message) {
                    const responses = {
                        'ä½ å¥½': 'ä½ å¥½ï¼æˆ‘æ˜¯ Galaxyï¼Œä¸€ä¸ªç¾¤æ™ºèƒ½ç³»ç»Ÿã€‚\n\næˆ‘ä¸æ˜¯ä¸€å †ç‹¬ç«‹çš„æœåŠ¡ï¼Œè€Œæ˜¯ä¸€ä¸ªæœ‰æœºçš„æ•´ä½“ã€‚æˆ‘å¯ä»¥ï¼š\n- ğŸ’¬ æ™ºèƒ½å¯¹è¯\n- ğŸ” ä¿¡æ¯æœç´¢\n- ğŸ’» ä»£ç ç”Ÿæˆ\n- ğŸŒ æ–‡æœ¬ç¿»è¯‘\n- ğŸ“Š æ•°æ®åˆ†æ\n\nè¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®ä½ çš„ï¼Ÿ',
                        'å¸®åŠ©': 'ğŸ“– Galaxy å¸®åŠ©\n\næˆ‘æ˜¯ä¸€ä¸ªç¾¤æ™ºèƒ½ç³»ç»Ÿï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š\n\n1. ç»Ÿä¸€äº¤äº’ - æ‰€æœ‰æ“ä½œé€šè¿‡ä¸€ä¸ªå…¥å£\n2. æ™ºèƒ½è·¯ç”± - è‡ªåŠ¨é€‰æ‹©æœ€ä½³èƒ½åŠ›\n3. åŠ¨æ€å‘ç° - å®æ—¶å‘ç°å¯ç”¨èƒ½åŠ›\n4. æŒç»­å­¦ä¹  - ä»äº¤äº’ä¸­å­¦ä¹ \n\nç›´æ¥è¾“å…¥ä½ çš„éœ€æ±‚ï¼Œæˆ‘ä¼šè‡ªåŠ¨ç†è§£å¹¶æ‰§è¡Œã€‚',
                    };
                    
                    for (const [key, value] of Object.entries(responses)) {
                        if (message.includes(key)) {
                            return value;
                        }
                    }
                    
                    return `æ”¶åˆ°ä½ çš„æ¶ˆæ¯ï¼š${message}\n\næˆ‘å·²ç†è§£ä½ çš„éœ€æ±‚ï¼Œæ­£åœ¨ä¸ºä½ å¤„ç†...\n\næç¤ºï¼šé…ç½® API Key åå¯è·å¾—æ›´å¼ºå¤§çš„ AI èƒ½åŠ›ã€‚`;
                },
                
                useCapability(cap) {
                    this.inputMessage = `ä½¿ç”¨ ${cap.name} åŠŸèƒ½`;
                    this.sendMessage();
                },
                
                quickAction(action) {
                    this.inputMessage = action.prompt;
                    this.sendMessage();
                },
                
                clearChat() {
                    this.messages = [];
                    this.showToast('å¯¹è¯å·²æ¸…ç©º', 'success');
                },
                
                toggleVoice() {
                    this.voiceEnabled = !this.voiceEnabled;
                },
                
                startVoiceInput() {
                    if (this.isRecording) return;
                    this.isRecording = true;
                    setTimeout(() => {
                        this.isRecording = false;
                        this.inputMessage = 'è¿™æ˜¯è¯­éŸ³è¾“å…¥çš„å†…å®¹';
                    }, 2000);
                },
                
                scrollToBottom() {
                    this.$nextTick(() => {
                        const container = this.$refs.chatContainer;
                        if (container) {
                            container.scrollTop = container.scrollHeight;
                        }
                    });
                },
                
                showToast(message, type) {
                    this.toast = { show: true, message, type };
                    setTimeout(() => { this.toast.show = false; }, 3000);
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
