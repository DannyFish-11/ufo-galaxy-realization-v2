<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galaxy - API Key ç®¡ç†</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        [v-cloak] { display: none; }
        .gradient-bg { background: linear-gradient(135deg, #0f0f23 0%, #1a1a3e 50%, #0f0f23 100%); }
        .glass-card { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .live-dot { animation: live 2s infinite; }
        @keyframes live { 0%, 100% { box-shadow: 0 0 0 0 rgba(0, 212, 255, 0.4); } 50% { box-shadow: 0 0 0 8px rgba(0, 212, 255, 0); } }
    </style>
</head>
<body class="gradient-bg min-h-screen text-white">
    <div id="app" v-cloak>
        <!-- Header -->
        <header class="border-b border-white/10">
            <div class="container mx-auto px-6 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <a href="/" class="text-3xl">ğŸŒŒ</a>
                        <div>
                            <h1 class="text-2xl font-bold bg-gradient-to-r from-cyan-400 to-purple-500 bg-clip-text text-transparent">
                                API Key ç®¡ç†
                            </h1>
                            <p class="text-sm text-gray-400">ç»Ÿä¸€ç®¡ç†æ‰€æœ‰ API Key <span class="live-dot inline-block w-2 h-2 bg-green-400 rounded-full ml-2"></span></p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <span class="text-sm text-gray-400">å·²é…ç½®: <span class="text-cyan-400">{{ configured }}</span>/{{ total }}</span>
                        <span class="text-sm text-gray-400">|</span>
                        <span class="text-sm text-gray-400">å»¶è¿Ÿ: <span :class="latencyClass">{{ latency }}ms</span></span>
                        <a href="/" class="text-gray-400 hover:text-white transition">è¿”å›</a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main -->
        <main class="container mx-auto px-6 py-8">
            <!-- Stats -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                <div class="glass-card rounded-xl p-4">
                    <div class="text-gray-400 text-xs mb-1">æ€» API Key</div>
                    <div class="text-2xl font-bold text-cyan-400">{{ total }}</div>
                    <div class="text-xs text-gray-500 mt-1">æ›´æ–°: {{ lastUpdate }}</div>
                </div>
                <div class="glass-card rounded-xl p-4">
                    <div class="text-gray-400 text-xs mb-1">å·²é…ç½®</div>
                    <div class="text-2xl font-bold text-green-400">{{ configured }}</div>
                    <div class="w-full bg-gray-700 rounded-full h-1 mt-2">
                        <div class="bg-green-400 h-1 rounded-full transition-all" :style="{width: (configured/total*100) + '%'}"></div>
                    </div>
                </div>
                <div class="glass-card rounded-xl p-4">
                    <div class="text-gray-400 text-xs mb-1">å·²å¯ç”¨</div>
                    <div class="text-2xl font-bold text-purple-400">{{ enabled }}</div>
                </div>
                <div class="glass-card rounded-xl p-4">
                    <div class="text-gray-400 text-xs mb-1">çŠ¶æ€</div>
                    <div class="text-2xl font-bold" :class="configured > 0 ? 'text-green-400' : 'text-yellow-400'">
                        {{ configured > 0 ? 'å¯ç”¨' : 'æœªé…ç½®' }}
                    </div>
                </div>
            </div>

            <!-- Categories -->
            <div class="glass-card rounded-xl overflow-hidden">
                <div class="border-b border-white/10 p-4">
                    <div class="flex items-center justify-between">
                        <h2 class="font-semibold">API Key åˆ—è¡¨</h2>
                        <div class="flex space-x-2">
                            <button v-for="cat in categories" :key="cat.id" 
                                    @click="currentCategory = cat.id"
                                    :class="['px-3 py-1 rounded text-sm', currentCategory === cat.id ? 'bg-cyan-600' : 'bg-white/10 hover:bg-white/20']">
                                {{ cat.name }} ({{ cat.count }})
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="p-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div v-for="key in filteredKeys" :key="key.id" 
                             class="p-4 rounded-lg bg-white/5 hover:bg-white/10 transition">
                            <div class="flex items-center justify-between mb-2">
                                <div class="flex items-center space-x-2">
                                    <span class="text-lg">{{ key.icon }}</span>
                                    <span class="font-medium">{{ key.name }}</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span v-if="key.configured" class="text-xs px-2 py-1 rounded bg-green-500/20 text-green-400">å·²é…ç½®</span>
                                    <span v-else class="text-xs px-2 py-1 rounded bg-gray-500/20 text-gray-400">æœªé…ç½®</span>
                                    <button @click="toggleKey(key)" 
                                            :class="['text-xs px-2 py-1 rounded', key.enabled ? 'bg-cyan-600' : 'bg-gray-600']">
                                        {{ key.enabled ? 'å¯ç”¨' : 'ç¦ç”¨' }}
                                    </button>
                                </div>
                            </div>
                            <div class="flex space-x-2">
                                <input :type="key.show ? 'text' : 'password'" 
                                       v-model="key.value"
                                       :placeholder="key.placeholder"
                                       class="flex-1 bg-white/5 border border-white/10 rounded px-3 py-2 text-sm outline-none focus:border-cyan-500">
                                <button @click="key.show = !key.show" class="px-3 py-2 bg-white/10 rounded text-sm">
                                    {{ key.show ? 'éšè—' : 'æ˜¾ç¤º' }}
                                </button>
                                <button @click="saveKey(key)" class="px-3 py-2 bg-cyan-600 rounded text-sm">ä¿å­˜</button>
                            </div>
                            <div v-if="key.url" class="mt-2">
                                <input v-model="key.url" placeholder="API URL"
                                       class="w-full bg-white/5 border border-white/10 rounded px-3 py-2 text-sm outline-none focus:border-cyan-500">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Toast -->
        <div v-if="toast.show" :class="['fixed bottom-8 right-8 px-6 py-3 rounded-lg', toast.type === 'success' ? 'bg-green-600' : 'bg-red-600']">
            {{ toast.message }}
        </div>
    </div>

    <script>
        const { createApp } = Vue;
        
        createApp({
            data() {
                return {
                    total: 16,
                    configured: 0,
                    enabled: 0,
                    latency: 0,
                    lastUpdate: '',
                    currentCategory: 'all',
                    
                    categories: [
                        { id: 'all', name: 'å…¨éƒ¨', count: 0 },
                        { id: 'llm', name: 'LLM', count: 0 },
                        { id: 'tool', name: 'å·¥å…·', count: 0 },
                        { id: 'storage', name: 'å­˜å‚¨', count: 0 }
                    ],
                    
                    keys: [
                        // LLM
                        { id: 'openai', name: 'OpenAI', icon: 'ğŸ¤–', category: 'llm', placeholder: 'sk-...', value: '', url: '', configured: false, enabled: false, show: false },
                        { id: 'deepseek', name: 'DeepSeek', icon: 'ğŸ§ ', category: 'llm', placeholder: 'sk-...', value: '', url: '', configured: false, enabled: false, show: false },
                        { id: 'anthropic', name: 'Anthropic', icon: 'ğŸ­', category: 'llm', placeholder: 'sk-ant-...', value: '', url: '', configured: false, enabled: false, show: false },
                        { id: 'google', name: 'Google AI', icon: 'ğŸ”', category: 'llm', placeholder: 'AIza...', value: '', url: '', configured: false, enabled: false, show: false },
                        { id: 'groq', name: 'Groq', icon: 'âš¡', category: 'llm', placeholder: 'gsk_...', value: '', url: '', configured: false, enabled: false, show: false },
                        // OneAPI
                        { id: 'oneapi', name: 'OneAPI', icon: 'ğŸŒ', category: 'llm', placeholder: 'OneAPI Key', value: '', url: 'http://localhost:3000', configured: false, enabled: false, show: false },
                        // Tools
                        { id: 'github', name: 'GitHub', icon: 'ğŸ“¦', category: 'tool', placeholder: 'ghp_...', value: '', configured: false, enabled: false, show: false },
                        { id: 'serper', name: 'Serper', icon: 'ğŸ”', category: 'tool', placeholder: 'Serper Key', value: '', configured: false, enabled: false, show: false },
                        // Storage
                        { id: 'qdrant', name: 'Qdrant', icon: 'ğŸ—„ï¸', category: 'storage', placeholder: 'Qdrant URL', value: '', configured: false, enabled: false, show: false },
                        { id: 'redis', name: 'Redis', icon: 'ğŸ”´', category: 'storage', placeholder: 'Redis URL', value: '', configured: false, enabled: false, show: false },
                    ],
                    
                    toast: { show: false, message: '', type: 'success' }
                };
            },
            computed: {
                latencyClass() {
                    if (this.latency < 100) return 'text-green-400';
                    if (this.latency < 500) return 'text-yellow-400';
                    return 'text-red-400';
                },
                filteredKeys() {
                    if (this.currentCategory === 'all') return this.keys;
                    return this.keys.filter(k => k.category === this.currentCategory);
                }
            },
            mounted() {
                this.loadStatus();
                this.loadKeys();
                setInterval(() => this.loadStatus(), 5000);
            },
            methods: {
                async loadStatus() {
                    const start = Date.now();
                    try {
                        const resp = await axios.get('/api/keys/status');
                        this.total = resp.data.total || this.total;
                        this.configured = resp.data.configured || 0;
                        this.enabled = resp.data.enabled || 0;
                        this.latency = Date.now() - start;
                        this.lastUpdate = new Date().toLocaleTimeString();
                        this.updateCategories();
                    } catch (e) {
                        this.latency = Date.now() - start;
                    }
                },
                
                async loadKeys() {
                    try {
                        const resp = await axios.get('/api/keys/list');
                        if (resp.data.keys) {
                            resp.data.keys.forEach(k => {
                                const key = this.keys.find(x => x.id === k.id);
                                if (key) {
                                    key.configured = k.configured;
                                    key.enabled = k.enabled;
                                }
                            });
                        }
                    } catch (e) {}
                },
                
                updateCategories() {
                    this.categories.forEach(cat => {
                        if (cat.id === 'all') {
                            cat.count = this.keys.length;
                        } else {
                            cat.count = this.keys.filter(k => k.category === cat.id).length;
                        }
                    });
                },
                
                toggleKey(key) {
                    key.enabled = !key.enabled;
                    this.showToast(`${key.name} å·²${key.enabled ? 'å¯ç”¨' : 'ç¦ç”¨'}`, 'success');
                },
                
                saveKey(key) {
                    if (key.value) {
                        key.configured = true;
                        this.configured = this.keys.filter(k => k.configured).length;
                        this.showToast(`${key.name} å·²ä¿å­˜`, 'success');
                    } else {
                        this.showToast('è¯·è¾“å…¥ API Key', 'error');
                    }
                },
                
                showToast(message, type) {
                    this.toast = { show: true, message, type };
                    setTimeout(() => this.toast.show = false, 3000);
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
