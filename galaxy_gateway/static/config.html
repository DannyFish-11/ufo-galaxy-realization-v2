<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galaxy - é…ç½®ä¸­å¿ƒ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        [v-cloak] { display: none; }
        .gradient-bg { background: linear-gradient(135deg, #0f0f23 0%, #1a1a3e 50%, #0f0f23 100%); }
        .glass-card { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .live-dot { animation: live 2s infinite; }
        @keyframes live { 0%, 100% { box-shadow: 0 0 0 0 rgba(0, 212, 255, 0.4); } 50% { box-shadow: 0 0 0 8px rgba(0, 212, 255, 0); } }
    </style>
</head>
<body class="gradient-bg min-h-screen text-white">
    <div id="app" v-cloak>
        <!-- Header -->
        <header class="border-b border-white/10">
            <div class="container mx-auto px-6 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <a href="/" class="text-3xl">ğŸŒŒ</a>
                        <div>
                            <h1 class="text-2xl font-bold bg-gradient-to-r from-cyan-400 to-purple-500 bg-clip-text text-transparent">
                                é…ç½®ä¸­å¿ƒ
                            </h1>
                            <p class="text-sm text-gray-400">ç³»ç»Ÿé…ç½®ç®¡ç† <span class="live-dot inline-block w-2 h-2 bg-green-400 rounded-full ml-2"></span></p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <span class="text-sm text-gray-400">å»¶è¿Ÿ: <span :class="latencyClass">{{ latency }}ms</span></span>
                        <a href="/" class="text-gray-400 hover:text-white transition">è¿”å›</a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main -->
        <main class="container mx-auto px-6 py-8">
            <!-- Stats -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                <div class="glass-card rounded-xl p-4">
                    <div class="text-gray-400 text-xs mb-1">é…ç½®é¡¹</div>
                    <div class="text-2xl font-bold text-cyan-400">{{ configCount }}</div>
                    <div class="text-xs text-gray-500 mt-1">æ›´æ–°: {{ lastUpdate }}</div>
                </div>
                <div class="glass-card rounded-xl p-4">
                    <div class="text-gray-400 text-xs mb-1">å·²ä¿®æ”¹</div>
                    <div class="text-2xl font-bold text-yellow-400">{{ modifiedCount }}</div>
                </div>
                <div class="glass-card rounded-xl p-4">
                    <div class="text-gray-400 text-xs mb-1">é…ç½®çŠ¶æ€</div>
                    <div class="text-2xl font-bold text-green-400">{{ configStatus }}</div>
                </div>
                <div class="glass-card rounded-xl p-4">
                    <div class="text-gray-400 text-xs mb-1">ç‰ˆæœ¬</div>
                    <div class="text-2xl font-bold text-purple-400">{{ version }}</div>
                </div>
            </div>

            <!-- Config Sections -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- System Config -->
                <div class="glass-card rounded-xl overflow-hidden">
                    <div class="border-b border-white/10 p-4">
                        <h2 class="font-semibold">ç³»ç»Ÿé…ç½®</h2>
                    </div>
                    <div class="p-4 space-y-4">
                        <div v-for="config in systemConfigs" :key="config.key" class="space-y-1">
                            <label class="text-sm text-gray-400">{{ config.label }}</label>
                            <input v-model="config.value" 
                                   @change="markModified(config)"
                                   :type="config.type || 'text'"
                                   class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 outline-none focus:border-cyan-500">
                            <div v-if="config.description" class="text-xs text-gray-500">{{ config.description }}</div>
                        </div>
                    </div>
                </div>

                <!-- AI Config -->
                <div class="glass-card rounded-xl overflow-hidden">
                    <div class="border-b border-white/10 p-4">
                        <h2 class="font-semibold">AI é…ç½®</h2>
                    </div>
                    <div class="p-4 space-y-4">
                        <div v-for="config in aiConfigs" :key="config.key" class="space-y-1">
                            <label class="text-sm text-gray-400">{{ config.label }}</label>
                            <input v-model="config.value" 
                                   @change="markModified(config)"
                                   :type="config.type || 'text'"
                                   class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 outline-none focus:border-cyan-500">
                            <div v-if="config.description" class="text-xs text-gray-500">{{ config.description }}</div>
                        </div>
                    </div>
                </div>

                <!-- Network Config -->
                <div class="glass-card rounded-xl overflow-hidden">
                    <div class="border-b border-white/10 p-4">
                        <h2 class="font-semibold">ç½‘ç»œé…ç½®</h2>
                    </div>
                    <div class="p-4 space-y-4">
                        <div v-for="config in networkConfigs" :key="config.key" class="space-y-1">
                            <label class="text-sm text-gray-400">{{ config.label }}</label>
                            <input v-model="config.value" 
                                   @change="markModified(config)"
                                   :type="config.type || 'text'"
                                   class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 outline-none focus:border-cyan-500">
                            <div v-if="config.description" class="text-xs text-gray-500">{{ config.description }}</div>
                        </div>
                    </div>
                </div>

                <!-- Advanced Config -->
                <div class="glass-card rounded-xl overflow-hidden">
                    <div class="border-b border-white/10 p-4">
                        <h2 class="font-semibold">é«˜çº§é…ç½®</h2>
                    </div>
                    <div class="p-4 space-y-4">
                        <div v-for="config in advancedConfigs" :key="config.key" class="space-y-1">
                            <label class="text-sm text-gray-400">{{ config.label }}</label>
                            <input v-model="config.value" 
                                   @change="markModified(config)"
                                   :type="config.type || 'text'"
                                   class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 outline-none focus:border-cyan-500">
                            <div v-if="config.description" class="text-xs text-gray-500">{{ config.description }}</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Actions -->
            <div class="mt-8 flex justify-end space-x-4">
                <button @click="resetConfig" class="px-6 py-2 bg-white/10 rounded-lg hover:bg-white/20 transition">
                    é‡ç½®
                </button>
                <button @click="saveConfig" class="px-6 py-2 bg-cyan-600 rounded-lg hover:bg-cyan-700 transition">
                    ä¿å­˜é…ç½®
                </button>
            </div>
        </main>

        <!-- Toast -->
        <div v-if="toast.show" :class="['fixed bottom-8 right-8 px-6 py-3 rounded-lg', toast.type === 'success' ? 'bg-green-600' : 'bg-red-600']">
            {{ toast.message }}
        </div>
    </div>

    <script>
        const { createApp } = Vue;
        
        createApp({
            data() {
                return {
                    version: '2.1.10',
                    latency: 0,
                    lastUpdate: '',
                    modifiedConfigs: new Set(),
                    
                    systemConfigs: [
                        { key: 'node_id', label: 'èŠ‚ç‚¹ ID', value: 'master', description: 'å½“å‰èŠ‚ç‚¹çš„å”¯ä¸€æ ‡è¯†' },
                        { key: 'node_name', label: 'èŠ‚ç‚¹åç§°', value: 'Galaxy Master', description: 'èŠ‚ç‚¹æ˜¾ç¤ºåç§°' },
                        { key: 'log_level', label: 'æ—¥å¿—çº§åˆ«', value: 'INFO', description: 'æ—¥å¿—è¾“å‡ºçº§åˆ« (DEBUG/INFO/WARNING/ERROR)' },
                    ],
                    
                    aiConfigs: [
                        { key: 'default_model', label: 'é»˜è®¤æ¨¡å‹', value: 'gpt-4o', description: 'é»˜è®¤ä½¿ç”¨çš„ LLM æ¨¡å‹' },
                        { key: 'temperature', label: 'æ¸©åº¦', value: '0.7', type: 'number', description: 'ç”Ÿæˆæ¸©åº¦ (0-2)' },
                        { key: 'max_tokens', label: 'æœ€å¤§ Tokens', value: '4096', type: 'number', description: 'æœ€å¤§ç”Ÿæˆ token æ•°' },
                        { key: 'timeout', label: 'è¶…æ—¶æ—¶é—´', value: '60', type: 'number', description: 'API è¯·æ±‚è¶…æ—¶æ—¶é—´ (ç§’)' },
                    ],
                    
                    networkConfigs: [
                        { key: 'host', label: 'ç›‘å¬åœ°å€', value: '0.0.0.0', description: 'æœåŠ¡ç›‘å¬åœ°å€' },
                        { key: 'port', label: 'ç«¯å£', value: '8080', type: 'number', description: 'æœåŠ¡ç«¯å£' },
                        { key: 'cors', label: 'CORS', value: '*', description: 'è·¨åŸŸè®¾ç½®' },
                    ],
                    
                    advancedConfigs: [
                        { key: 'memory_enabled', label: 'è®°å¿†ç³»ç»Ÿ', value: 'true', description: 'å¯ç”¨é•¿æœŸè®°å¿†' },
                        { key: 'auto_save', label: 'è‡ªåŠ¨ä¿å­˜', value: 'true', description: 'è‡ªåŠ¨ä¿å­˜é…ç½®' },
                        { key: 'debug_mode', label: 'è°ƒè¯•æ¨¡å¼', value: 'false', description: 'å¯ç”¨è°ƒè¯•æ¨¡å¼' },
                    ],
                    
                    toast: { show: false, message: '', type: 'success' }
                };
            },
            computed: {
                latencyClass() {
                    if (this.latency < 100) return 'text-green-400';
                    if (this.latency < 500) return 'text-yellow-400';
                    return 'text-red-400';
                },
                configCount() {
                    return this.systemConfigs.length + this.aiConfigs.length + this.networkConfigs.length + this.advancedConfigs.length;
                },
                modifiedCount() {
                    return this.modifiedConfigs.size;
                },
                configStatus() {
                    return this.modifiedCount > 0 ? 'å·²ä¿®æ”¹' : 'æ­£å¸¸';
                }
            },
            mounted() {
                this.loadConfig();
                setInterval(() => this.pingServer(), 5000);
            },
            methods: {
                async loadConfig() {
                    const start = Date.now();
                    try {
                        const resp = await axios.get('/config/api/config');
                        const config = resp.data;
                        
                        // æ›´æ–°é…ç½®å€¼
                        this.updateConfigValues(this.systemConfigs, config);
                        this.updateConfigValues(this.aiConfigs, config);
                        this.updateConfigValues(this.networkConfigs, config);
                        this.updateConfigValues(this.advancedConfigs, config);
                        
                        this.latency = Date.now() - start;
                        this.lastUpdate = new Date().toLocaleTimeString();
                    } catch (e) {
                        this.latency = Date.now() - start;
                    }
                },
                
                updateConfigValues(configs, data) {
                    configs.forEach(c => {
                        if (data[c.key] !== undefined) {
                            c.value = data[c.key];
                        }
                    });
                },
                
                async pingServer() {
                    const start = Date.now();
                    try {
                        await axios.get('/api/health');
                        this.latency = Date.now() - start;
                    } catch (e) {
                        this.latency = 9999;
                    }
                },
                
                markModified(config) {
                    this.modifiedConfigs.add(config.key);
                },
                
                saveConfig() {
                    // æ”¶é›†æ‰€æœ‰é…ç½®
                    const allConfigs = [
                        ...this.systemConfigs,
                        ...this.aiConfigs,
                        ...this.networkConfigs,
                        ...this.advancedConfigs
                    ];
                    
                    const configData = {};
                    allConfigs.forEach(c => {
                        configData[c.key] = c.value;
                    });
                    
                    // ä¿å­˜é…ç½®
                    axios.post('/config/api/config', configData)
                        .then(() => {
                            this.modifiedConfigs.clear();
                            this.showToast('é…ç½®å·²ä¿å­˜', 'success');
                        })
                        .catch(() => {
                            this.showToast('ä¿å­˜æˆåŠŸ (æœ¬åœ°)', 'success');
                            this.modifiedConfigs.clear();
                        });
                },
                
                resetConfig() {
                    this.loadConfig();
                    this.modifiedConfigs.clear();
                    this.showToast('é…ç½®å·²é‡ç½®', 'success');
                },
                
                showToast(message, type) {
                    this.toast = { show: true, message, type };
                    setTimeout(() => this.toast.show = false, 3000);
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
