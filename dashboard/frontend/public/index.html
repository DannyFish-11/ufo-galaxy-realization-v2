<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galaxy - æ˜Ÿç³»æ™ºèƒ½ä½“</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap');
        
        * { font-family: 'Rajdhani', sans-serif; }
        body { background: #000000; overflow: hidden; }
        
        .galaxy-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(ellipse at center, #0a0a20 0%, #000000 70%),
                        radial-gradient(circle at 20% 80%, rgba(120, 0, 255, 0.15) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(0, 150, 255, 0.15) 0%, transparent 50%);
            z-index: -2;
        }
        
        .stars { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; overflow: hidden; }
        .star { position: absolute; background: white; border-radius: 50%; animation: twinkle var(--duration) ease-in-out infinite; }
        @keyframes twinkle { 0%, 100% { opacity: var(--opacity); } 50% { opacity: 0.2; } }
        
        .galaxy-title {
            font-family: 'Orbitron', monospace;
            background: linear-gradient(135deg, #00d4ff, #7b2fff, #ff006e, #00d4ff);
            background-size: 300% 300%;
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            animation: gradient-shift 5s ease infinite;
        }
        @keyframes gradient-shift { 0%, 100% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } }
        
        .status-card { background: rgba(10, 10, 30, 0.6); border: 1px solid rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); }
        .galaxy-input { background: rgba(10, 10, 30, 0.8); border: 1px solid rgba(0, 212, 255, 0.3); transition: all 0.3s ease; }
        .galaxy-input:focus { border-color: rgba(0, 212, 255, 0.6); box-shadow: 0 0 20px rgba(0, 212, 255, 0.2); }
        
        .tab-active { background: linear-gradient(135deg, rgba(0, 212, 255, 0.2), rgba(123, 47, 255, 0.2)); border-bottom: 2px solid #00d4ff; }
        
        .valid { color: #00ff88; }
        .invalid { color: #ff4444; }
        .pending { color: #ffaa00; }
        
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.3); }
        ::-webkit-scrollbar-thumb { background: linear-gradient(180deg, #00d4ff, #7b2fff); border-radius: 3px; }
    </style>
</head>
<body class="text-white min-h-screen">
    <div class="galaxy-bg"></div>
    <div class="stars" ref="starsContainer"></div>
    
    <div id="app" class="h-screen flex flex-col relative z-10">
        
        <!-- é¡¶éƒ¨å¯¼èˆª -->
        <header class="px-6 py-3 border-b border-white/10 bg-black/30 backdrop-blur-md">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2">
                        <div class="w-8 h-8 rounded-full bg-gradient-to-br from-cyan-400 to-purple-600 flex items-center justify-center">
                            <span class="text-sm font-bold">G</span>
                        </div>
                        <h1 class="galaxy-title text-xl font-bold tracking-wider">GALAXY</h1>
                    </div>
                    <span class="text-xs text-gray-500 font-mono">v2.3.25</span>
                </div>
                
                <!-- æ ‡ç­¾é¡µ -->
                <div class="flex space-x-1 text-sm">
                    <button @click="currentTab = 'chat'" :class="currentTab === 'chat' ? 'tab-active' : ''" class="px-3 py-1.5 rounded-t-lg transition-all hover:bg-white/5">ğŸ’¬ å¯¹è¯</button>
                    <button @click="currentTab = 'llm'" :class="currentTab === 'llm' ? 'tab-active' : ''" class="px-3 py-1.5 rounded-t-lg transition-all hover:bg-white/5">ğŸ¤– LLM</button>
                    <button @click="currentTab = 'tools'" :class="currentTab === 'tools' ? 'tab-active' : ''" class="px-3 py-1.5 rounded-t-lg transition-all hover:bg-white/5">ğŸ”§ å·¥å…·</button>
                    <button @click="currentTab = 'nodes'" :class="currentTab === 'nodes' ? 'tab-active' : ''" class="px-3 py-1.5 rounded-t-lg transition-all hover:bg-white/5">ğŸŒ èŠ‚ç‚¹</button>
                </div>
                
                <div class="flex items-center space-x-3 text-xs">
                    <span class="text-green-400" v-if="configuredCount > 0">âœ“ {{ configuredCount }} å·²é…ç½®</span>
                    <span class="text-gray-600 font-mono">{{ currentTime }}</span>
                </div>
            </div>
        </header>
        
        <!-- ä¸»å†…å®¹åŒº -->
        <main class="flex-1 overflow-hidden">
            
            <!-- å¯¹è¯é¡µé¢ -->
            <div v-show="currentTab === 'chat'" class="h-full flex flex-col">
                <div class="flex-1 overflow-auto p-4 space-y-3" ref="chatContainer">
                    <div v-if="messages.length === 0" class="text-center py-16">
                        <div class="galaxy-title text-3xl font-bold mb-3">GALAXY</div>
                        <div class="text-gray-500 mb-2">L4 çº§è‡ªä¸»æ€§æ™ºèƒ½ç³»ç»Ÿ</div>
                        <div class="text-gray-600 text-sm">è¯·å…ˆé…ç½® API Key</div>
                    </div>
                    
                    <div v-for="msg in messages" :key="msg.id" class="flex" :class="msg.role === 'user' ? 'justify-end' : 'justify-start'">
                        <div class="max-w-2xl rounded-xl p-3 text-sm" :class="msg.role === 'user' ? 'bg-cyan-900/30 border border-cyan-500/30' : 'bg-purple-900/30 border border-purple-500/30'">
                            <div class="whitespace-pre-wrap">{{ msg.content }}</div>
                            <div class="text-xs mt-1 opacity-50">{{ formatTime(msg.timestamp) }}</div>
                        </div>
                    </div>
                    
                    <div v-if="isLoading" class="flex justify-start">
                        <div class="bg-purple-900/30 rounded-xl p-3">
                            <div class="flex space-x-1">
                                <div class="w-2 h-2 bg-cyan-400 rounded-full animate-bounce"></div>
                                <div class="w-2 h-2 bg-purple-400 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                                <div class="w-2 h-2 bg-pink-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="p-3 border-t border-white/10 bg-black/30">
                    <div class="flex space-x-2">
                        <input v-model="inputMessage" @keypress.enter="sendMessage" type="text" placeholder="è¾“å…¥æ¶ˆæ¯..." class="galaxy-input flex-1 rounded-lg px-3 py-2 text-sm outline-none">
                        <button @click="sendMessage" class="px-4 py-2 rounded-lg text-sm bg-gradient-to-r from-cyan-500 to-purple-600">å‘é€</button>
                    </div>
                </div>
            </div>
            
            <!-- LLM é…ç½®é¡µé¢ -->
            <div v-show="currentTab === 'llm'" class="h-full overflow-auto p-4">
                <div class="max-w-5xl mx-auto space-y-4">
                    
                    <!-- çŠ¶æ€ -->
                    <div class="status-card rounded-xl p-3">
                        <div class="grid grid-cols-5 gap-3 text-center text-sm">
                            <div><div class="text-xl font-bold text-cyan-400">{{ configStatus.total_models || 0 }}</div><div class="text-xs text-gray-500">æ€»æ¨¡å‹</div></div>
                            <div><div class="text-xl font-bold text-green-400">{{ configStatus.configured_models || 0 }}</div><div class="text-xs text-gray-500">å·²é…ç½®</div></div>
                            <div><div class="text-xl font-bold text-purple-400">{{ configStatus.total_tools || 0 }}</div><div class="text-xs text-gray-500">å·¥å…·</div></div>
                            <div><div class="text-xl font-bold text-pink-400">{{ configStatus.configured_tools || 0 }}</div><div class="text-xs text-gray-500">å·¥å…·å·²é…</div></div>
                            <div><div class="text-xl font-bold" :class="configStatus.oneapi_configured ? 'text-green-400' : 'text-red-400'">{{ configStatus.oneapi_configured ? 'âœ“' : 'âœ—' }}</div><div class="text-xs text-gray-500">OneAPI</div></div>
                        </div>
                    </div>
                    
                    <!-- OneAPI -->
                    <div class="status-card rounded-xl p-3">
                        <h3 class="font-semibold mb-2">ğŸ”— OneAPI èšåˆå™¨ (æ ¸å¿ƒ)</h3>
                        <div class="grid grid-cols-3 gap-2">
                            <input v-model="oneapiUrl" type="text" placeholder="Base URL" class="galaxy-input rounded px-2 py-1 text-sm outline-none">
                            <input v-model="oneapiKey" type="password" placeholder="API Key" class="galaxy-input rounded px-2 py-1 text-sm outline-none">
                            <div class="flex space-x-1">
                                <button @click="saveOneAPI" class="flex-1 py-1 rounded bg-cyan-600 hover:bg-cyan-500 text-xs">ä¿å­˜</button>
                                <button @click="validateOneAPI" class="flex-1 py-1 rounded bg-green-600 hover:bg-green-500 text-xs">éªŒè¯</button>
                            </div>
                        </div>
                        <div v-if="oneapiStatus" class="mt-2 text-xs" :class="oneapiStatus.valid ? 'valid' : 'invalid'">{{ oneapiStatus.message || oneapiStatus.error }}</div>
                    </div>
                    
                    <!-- ç›´æ¥æ¨¡å‹ -->
                    <div class="status-card rounded-xl p-3">
                        <h3 class="font-semibold mb-2">ğŸ¤– ç›´æ¥æ¨¡å‹ (ç»†èŠ‚)</h3>
                        <div class="grid grid-cols-3 gap-2">
                            <div v-for="(provider, name) in directProviders" :key="name" class="bg-black/30 rounded p-2">
                                <div class="flex items-center justify-between mb-1">
                                    <span class="text-xs font-medium">{{ provider.name }}</span>
                                    <span :class="provider.valid ? 'valid' : (provider.apiKey ? 'pending' : 'text-gray-500')" class="text-xs">
                                        {{ provider.valid ? 'âœ“' : (provider.apiKey ? '?' : 'âœ—') }}
                                    </span>
                                </div>
                                <input v-model="provider.apiKey" type="password" placeholder="API Key" class="galaxy-input w-full rounded px-2 py-1 text-xs outline-none mb-1">
                                <div class="flex space-x-1">
                                    <button @click="saveProvider(name, provider.apiKey)" class="flex-1 py-0.5 rounded bg-purple-600 hover:bg-purple-500 text-xs">ä¿å­˜</button>
                                    <button @click="validateProvider(name)" class="flex-1 py-0.5 rounded bg-green-600 hover:bg-green-500 text-xs">éªŒè¯</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æµ‹è¯• -->
                    <div class="status-card rounded-xl p-3">
                        <h3 class="font-semibold mb-2">ğŸ§ª æµ‹è¯• LLM</h3>
                        <div class="flex space-x-2">
                            <input v-model="testMessage" type="text" placeholder="æµ‹è¯•æ¶ˆæ¯" class="galaxy-input flex-1 rounded px-2 py-1 text-sm outline-none">
                            <button @click="testLLM" class="px-3 py-1 rounded bg-green-600 hover:bg-green-500 text-sm">æµ‹è¯•</button>
                        </div>
                        <div v-if="testResult" class="mt-2 p-2 bg-black/30 rounded text-xs">
                            <pre class="whitespace-pre-wrap">{{ testResult }}</pre>
                        </div>
                    </div>
                    
                </div>
            </div>
            
            <!-- å·¥å…·é…ç½®é¡µé¢ -->
            <div v-show="currentTab === 'tools'" class="h-full overflow-auto p-4">
                <div class="max-w-5xl mx-auto">
                    <div class="status-card rounded-xl p-3">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="font-semibold">ğŸ”§ å·¥å…· API é…ç½®</h3>
                            <button @click="validateAllTools" class="px-3 py-1 rounded bg-green-600 hover:bg-green-500 text-xs">éªŒè¯å…¨éƒ¨</button>
                        </div>
                        
                        <div class="grid grid-cols-3 gap-2">
                            <div v-for="tool in tools" :key="tool.tool_id" class="bg-black/30 rounded p-2">
                                <div class="flex items-center justify-between mb-1">
                                    <span class="text-xs font-medium">{{ tool.name }}</span>
                                    <span :class="tool.valid ? 'valid' : (tool.apiKey ? 'pending' : 'text-gray-500')" class="text-xs">
                                        {{ tool.valid ? 'âœ“ æœ‰æ•ˆ' : (tool.apiKey ? '? å¾…éªŒè¯' : 'âœ— æœªé…ç½®') }}
                                    </span>
                                </div>
                                <div class="text-xs text-gray-500 mb-1">{{ tool.description }}</div>
                                <input v-model="tool.apiKey" type="password" placeholder="API Key" class="galaxy-input w-full rounded px-2 py-1 text-xs outline-none mb-1">
                                <div class="flex space-x-1">
                                    <button @click="saveTool(tool.tool_id, tool.apiKey)" class="flex-1 py-0.5 rounded bg-cyan-600 hover:bg-cyan-500 text-xs">ä¿å­˜</button>
                                    <button @click="validateTool(tool.tool_id)" class="flex-1 py-0.5 rounded bg-green-600 hover:bg-green-500 text-xs">éªŒè¯</button>
                                </div>
                                <div v-if="tool.status" class="mt-1 text-xs" :class="tool.valid ? 'valid' : 'invalid'">{{ tool.status }}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- èŠ‚ç‚¹é¡µé¢ -->
            <div v-show="currentTab === 'nodes'" class="h-full overflow-auto p-4">
                <div class="max-w-5xl mx-auto">
                    <div class="status-card rounded-xl p-3">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="font-semibold">ğŸŒ èŠ‚ç‚¹çŠ¶æ€</h3>
                            <button @click="checkNodes" class="px-3 py-1 rounded bg-cyan-600 hover:bg-cyan-500 text-xs">æ£€æŸ¥å…¨éƒ¨</button>
                        </div>
                        
                        <div class="grid grid-cols-6 gap-1">
                            <div v-for="node in nodes" :key="node.node_id" class="bg-black/30 rounded p-1 text-center cursor-pointer hover:bg-black/50">
                                <div class="text-xs text-gray-500">{{ node.node_id }}</div>
                                <div class="text-xs truncate">{{ node.name }}</div>
                                <div class="text-xs" :class="node.status === 'healthy' ? 'valid' : 'text-gray-500'">{{ node.status || '?' }}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
        </main>
    </div>
    
    <script>
        const { createApp, ref, onMounted, computed } = Vue;
        
        createApp({
            setup() {
                const currentTab = ref('llm');
                const messages = ref([]);
                const inputMessage = ref('');
                const isLoading = ref(false);
                const currentTime = ref('');
                const chatContainer = ref(null);
                const starsContainer = ref(null);
                
                const configStatus = ref({});
                const oneapiUrl = ref('http://localhost:8001/v1');
                const oneapiKey = ref('');
                const oneapiStatus = ref(null);
                
                const directProviders = ref({
                    openai: { name: 'OpenAI', apiKey: '', valid: false },
                    anthropic: { name: 'Anthropic', apiKey: '', valid: false },
                    deepseek: { name: 'DeepSeek', apiKey: '', valid: false },
                    zhipu: { name: 'æ™ºè°± AI', apiKey: '', valid: false },
                    groq: { name: 'Groq', apiKey: '', valid: false },
                    openrouter: { name: 'OpenRouter', apiKey: '', valid: false },
                    gemini: { name: 'Gemini', apiKey: '', valid: false },
                    qwen: { name: 'é€šä¹‰åƒé—®', apiKey: '', valid: false }
                });
                
                const tools = ref([]);
                const nodes = ref([]);
                const testMessage = ref('Hello');
                const testResult = ref('');
                
                const configuredCount = computed(() => {
                    let count = 0;
                    if (oneapiKey.value) count++;
                    for (const p of Object.values(directProviders.value)) {
                        if (p.apiKey) count++;
                    }
                    for (const t of tools.value) {
                        if (t.apiKey) count++;
                    }
                    return count;
                });
                
                const generateStars = () => {
                    if (!starsContainer.value) return;
                    for (let i = 0; i < 80; i++) {
                        const star = document.createElement('div');
                        star.className = 'star';
                        star.style.left = Math.random() * 100 + '%';
                        star.style.top = Math.random() * 100 + '%';
                        star.style.width = Math.random() * 2 + 1 + 'px';
                        star.style.height = star.style.width;
                        star.style.setProperty('--duration', (Math.random() * 3 + 2) + 's');
                        star.style.setProperty('--opacity', Math.random() * 0.5 + 0.3);
                        starsContainer.value.appendChild(star);
                    }
                };
                
                const updateTime = () => { currentTime.value = new Date().toLocaleTimeString('zh-CN', { hour12: false }); };
                
                const loadConfigStatus = async () => {
                    try {
                        const response = await axios.get('/api/v1/config/status');
                        configStatus.value = response.data;
                    } catch (error) { console.error('Failed to load config status:', error); }
                };
                
                const loadTools = async () => {
                    try {
                        const response = await axios.get('/api/v1/config/tools');
                        tools.value = (response.data.tools || []).map(t => ({ ...t, status: '' }));
                    } catch (error) { console.error('Failed to load tools:', error); }
                };
                
                const loadNodes = async () => {
                    try {
                        const response = await axios.get('/api/v1/config/nodes');
                        nodes.value = response.data.nodes || [];
                    } catch (error) { console.error('Failed to load nodes:', error); }
                };
                
                const saveOneAPI = async () => {
                    try {
                        await axios.post('/api/v1/config/api-key', { provider: 'oneapi', api_key: oneapiKey.value });
                        loadConfigStatus();
                    } catch (error) { alert('ä¿å­˜å¤±è´¥: ' + error.message); }
                };
                
                const validateOneAPI = async () => {
                    oneapiStatus.value = { valid: false, message: 'éªŒè¯ä¸­...' };
                    try {
                        const response = await axios.post('/api/v1/config/validate', { category: 'oneapi', key_name: '' });
                        oneapiStatus.value = response.data;
                    } catch (error) { oneapiStatus.value = { valid: false, error: error.message }; }
                };
                
                const saveProvider = async (name, apiKey) => {
                    try {
                        await axios.post('/api/v1/config/api-key', { provider: name, api_key: apiKey });
                        loadConfigStatus();
                    } catch (error) { alert('ä¿å­˜å¤±è´¥: ' + error.message); }
                };
                
                const validateProvider = async (name) => {
                    directProviders.value[name].valid = false;
                    try {
                        const response = await axios.post('/api/v1/config/validate', { category: 'direct_models', key_name: name });
                        directProviders.value[name].valid = response.data.valid;
                    } catch (error) { directProviders.value[name].valid = false; }
                };
                
                const saveTool = async (toolId, apiKey) => {
                    try {
                        await axios.post('/api/v1/config/tools/api-key', { tool_id: toolId, api_key: apiKey });
                        loadConfigStatus();
                    } catch (error) { alert('ä¿å­˜å¤±è´¥: ' + error.message); }
                };
                
                const validateTool = async (toolId) => {
                    const tool = tools.value.find(t => t.tool_id === toolId);
                    if (tool) {
                        tool.status = 'éªŒè¯ä¸­...';
                        try {
                            const response = await axios.post('/api/v1/config/validate', { category: 'tools', key_name: toolId });
                            tool.valid = response.data.valid;
                            tool.status = response.data.valid ? 'æœ‰æ•ˆ' : response.data.error;
                        } catch (error) { tool.status = error.message; }
                    }
                };
                
                const validateAllTools = async () => {
                    for (const tool of tools.value) {
                        if (tool.apiKey) {
                            await validateTool(tool.tool_id);
                        }
                    }
                };
                
                const testLLM = async () => {
                    testResult.value = 'æµ‹è¯•ä¸­...';
                    try {
                        const response = await axios.post('/api/v1/config/test-llm', { message: testMessage.value });
                        testResult.value = JSON.stringify(response.data, null, 2);
                    } catch (error) { testResult.value = 'æµ‹è¯•å¤±è´¥: ' + error.message; }
                };
                
                const checkNodes = async () => {
                    try {
                        const response = await axios.post('/api/v1/config/nodes/check');
                        const results = response.data.results;
                        nodes.value.forEach(node => { node.status = results[node.node_id]?.success ? 'healthy' : 'error'; });
                    } catch (error) { console.error('Failed to check nodes:', error); }
                };
                
                const sendMessage = async () => {
                    if (!inputMessage.value.trim() || isLoading.value) return;
                    const message = inputMessage.value.trim();
                    inputMessage.value = '';
                    messages.value.push({ id: Date.now(), role: 'user', content: message, timestamp: new Date() });
                    isLoading.value = true;
                    try {
                        const response = await axios.post('/api/v1/chat', { message });
                        messages.value.push({ id: Date.now() + 1, role: 'assistant', content: response.data.response || 'å¤„ç†å®Œæˆ', timestamp: new Date() });
                    } catch (error) {
                        messages.value.push({ id: Date.now() + 1, role: 'assistant', content: 'âŒ è¿æ¥å¤±è´¥: ' + error.message, timestamp: new Date() });
                    }
                    isLoading.value = false;
                };
                
                const formatTime = (date) => new Date(date).toLocaleTimeString('zh-CN', { hour12: false });
                
                onMounted(() => {
                    generateStars();
                    updateTime();
                    setInterval(updateTime, 1000);
                    loadConfigStatus();
                    loadTools();
                    loadNodes();
                });
                
                return {
                    currentTab, messages, inputMessage, isLoading, currentTime, chatContainer, starsContainer,
                    configStatus, oneapiUrl, oneapiKey, oneapiStatus, directProviders, tools, nodes,
                    testMessage, testResult, configuredCount,
                    loadConfigStatus, saveOneAPI, validateOneAPI, saveProvider, validateProvider,
                    saveTool, validateTool, validateAllTools, testLLM, checkNodes, sendMessage, formatTime
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
